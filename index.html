<!DOCTYPE html>
<html lang="fr" data-theme="light" data-color="default">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TITAN Pro - Ultimate Trading Journal</title>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Date Picker -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    
    <!-- TradingView Widget -->
    <script src="https://s3.tradingview.com/tv.js"></script>
    
    <style>
        /* =========================================
           1. CORE VARIABLES & THEME SYSTEM ULTIMATE
           ========================================= */
        :root {
            /* Mode Clair par défaut */
            --bg-primary: #FFFFFF;
            --bg-secondary: #F8FAFC;
            --bg-tertiary: #F1F5F9;
            --bg-card: #FFFFFF;
            --bg-header: rgba(255, 255, 255, 0.95);
            --text-primary: #1E293B;
            --text-secondary: #64748B;
            --text-muted: #94A3B8;
            --border: #E2E8F0;
            --border-light: #F1F5F9;
            
            /* Dynamic Accent System */
            --accent-main: #00AB55;
            --accent-gradient: linear-gradient(135deg, var(--accent-main) 0%, #006C35 100%);
            
            /* Semantic Colors Extended */
            --success: #00AB55;
            --success-light: rgba(0, 171, 85, 0.12);
            --success-dark: #008542;
            --danger: #FF4842;
            --danger-light: rgba(255, 72, 66, 0.12);
            --danger-dark: #D32F2F;
            --warning: #FFC107;
            --warning-light: rgba(255, 193, 7, 0.12);
            --info: #1890FF;
            --info-light: rgba(24, 144, 255, 0.12);
            --primary: #1E293B;
            --secondary: #64748B;
            
            /* Extended Color Palette */
            --accent-blue: #1890FF;
            --accent-purple: #7635DC;
            --accent-orange: #FD7E14;
            --accent-pink: #E64980;
            --accent-cyan: #00B8D9;
            
            /* UI Properties */
            --shadow: 0 8px 24px -4px rgba(145, 158, 171, 0.24);
            --shadow-lg: 0 20px 40px -12px rgba(145, 158, 171, 0.32);
            --shadow-sm: 0 2px 8px rgba(145, 158, 171, 0.16);
            --radius: 12px;
            --radius-sm: 8px;
            --radius-lg: 16px;
            --safe-top: env(safe-area-inset-top, 0px);
            --safe-bottom: env(safe-area-inset-bottom, 0px);
            
            /* Animation Speeds */
            --transition-fast: 0.15s;
            --transition-normal: 0.3s;
            --transition-slow: 0.5s;
            
            /* Z-index Layers */
            --z-dropdown: 1000;
            --z-sticky: 1020;
            --z-fixed: 1030;
            --z-modal-backdrop: 1040;
            --z-modal: 1050;
            --z-popover: 1060;
            --z-tooltip: 1070;
            --z-toast: 1080;
            --z-max: 9999;
        }

        /* Dark Mode */
        [data-theme="dark"] {
            --bg-primary: #0F172A;
            --bg-secondary: #1E293B;
            --bg-tertiary: #334155;
            --bg-card: #1E293B;
            --bg-header: rgba(30, 41, 59, 0.95);
            --text-primary: #F1F5F9;
            --text-secondary: #94A3B8;
            --text-muted: #64748B;
            --border: #334155;
            --border-light: #1E293B;
            
            --shadow: 0 8px 24px -4px rgba(0, 0, 0, 0.48);
            --shadow-lg: 0 20px 40px -12px rgba(0, 0, 0, 0.56);
            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.32);
        }

        /* Color Themes */
        [data-color="blue"] { 
            --accent-main: #1890FF;
            --accent-gradient: linear-gradient(135deg, #1890FF 0%, #0052CC 100%);
            --success: #1890FF;
            --accent-blue: #1890FF;
        }
        [data-color="purple"] { 
            --accent-main: #7635DC;
            --accent-gradient: linear-gradient(135deg, #7635DC 0%, #4C1D95 100%);
            --success: #7635DC;
            --accent-purple: #7635DC;
        }
        [data-color="orange"] { 
            --accent-main: #FD7E14;
            --accent-gradient: linear-gradient(135deg, #FD7E14 0%, #E8590C 100%);
            --success: #FD7E14;
            --accent-orange: #FD7E14;
        }
        [data-color="red"] { 
            --accent-main: #FF4842;
            --accent-gradient: linear-gradient(135deg, #FF4842 0%, #D32F2F 100%);
            --success: #FF4842;
            --danger: #FF4842;
        }
        [data-color="pink"] { 
            --accent-main: #E64980;
            --accent-gradient: linear-gradient(135deg, #E64980 0%, #C2255C 100%);
            --success: #E64980;
            --accent-pink: #E64980;
        }
        [data-color="cyan"] { 
            --accent-main: #00B8D9;
            --accent-gradient: linear-gradient(135deg, #00B8D9 0%, #0095B3 100%);
            --success: #00B8D9;
            --accent-cyan: #00B8D9;
        }

        /* =========================================
           2. RESET & BASE STYLES
           ========================================= */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Public Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            padding-top: var(--safe-top);
            padding-bottom: var(--safe-bottom);
            transition: background var(--transition-normal), color var(--transition-normal);
            overflow-x: hidden;
            font-size: 14px;
        }

        /* Typography Scale */
        h1 { font-size: 2rem; font-weight: 800; line-height: 1.2; }
        h2 { font-size: 1.75rem; font-weight: 700; line-height: 1.3; }
        h3 { font-size: 1.5rem; font-weight: 700; line-height: 1.4; }
        h4 { font-size: 1.25rem; font-weight: 600; line-height: 1.5; }
        h5 { font-size: 1.125rem; font-weight: 600; line-height: 1.5; }
        h6 { font-size: 1rem; font-weight: 600; line-height: 1.5; }

        /* =========================================
           3. SPECIAL FEATURES & MODES
           ========================================= */
        /* Ghost Mode */
        body.ghost-mode .sensitive,
        body.ghost-mode .sensitive * {
            color: transparent !important;
            text-shadow: 0 0 12px rgba(0,0,0,0.6) !important;
            user-select: none !important;
            pointer-events: none !important;
        }
        body.ghost-mode .sensitive::before {
            content: '****';
            color: var(--text-muted);
        }

        /* Concentration Mode */
        body.concentration-mode .bottom-nav,
        body.concentration-mode .header-actions,
        body.concentration-mode .fab,
        body.concentration-mode .quick-actions,
        body.concentration-mode .non-essential,
        body.concentration-mode .stats-minor,
        body.concentration-mode .calendar-grid,
        body.concentration-mode .heatmap-container {
            display: none !important;
        }
        
        #exit-concentration-btn {
            display: none;
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: var(--z-max);
            background: var(--danger);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: var(--radius);
            font-weight: 700;
            font-size: 13px;
            cursor: pointer;
            box-shadow: var(--shadow-lg);
            transition: all var(--transition-fast);
            backdrop-filter: blur(10px);
        }
        #exit-concentration-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(255, 72, 66, 0.3);
        }
        body.concentration-mode #exit-concentration-btn {
            display: block;
            animation: fadeIn 0.5s ease-out;
        }

        /* Reading Mode */
        body.reading-mode {
            background: #F9F5EB !important;
            color: #1E293B !important;
        }
        [data-theme="dark"] body.reading-mode {
            background: #1A1A2E !important;
            color: #E6E6E6 !important;
        }

        /* =========================================
           4. ANIMATIONS & TRANSITIONS
           ========================================= */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes fadeOut {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(-10px); }
        }
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes slideInLeft {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        @keyframes shimmer {
            0% { background-position: -1000px 0; }
            100% { background-position: 1000px 0; }
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .animate-fade-in { animation: fadeIn 0.4s ease-out; }
        .animate-slide-in-right { animation: slideInRight 0.3s ease-out; }
        .animate-slide-in-left { animation: slideInLeft 0.3s ease-out; }
        .animate-pulse { animation: pulse 2s infinite; }
        .animate-float { animation: float 3s ease-in-out infinite; }
        .animate-spin { animation: spin 1s linear infinite; }

        /* =========================================
           5. LAYOUT & CONTAINERS
           ========================================= */
        .app-container {
            position: relative;
            min-height: 100vh;
            padding-bottom: 80px;
        }

        .main-container {
            padding: 80px 16px 100px 16px;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }

        .page {
            display: none;
            animation: fadeIn 0.4s ease-out;
        }
        .page.active {
            display: block;
        }

        .section {
            margin-bottom: 24px;
        }
        .section-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .section-title i {
            color: var(--accent-main);
        }

        /* Grid Systems */
        .grid {
            display: grid;
            gap: 16px;
        }
        .grid-2 { grid-template-columns: repeat(2, 1fr); }
        .grid-3 { grid-template-columns: repeat(3, 1fr); }
        .grid-4 { grid-template-columns: repeat(4, 1fr); }
        .grid-auto { grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); }

        /* Flex Utilities */
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .justify-center { justify-content: center; }
        .gap-4 { gap: 4px; }
        .gap-8 { gap: 8px; }
        .gap-12 { gap: 12px; }
        .gap-16 { gap: 16px; }
        .gap-24 { gap: 24px; }

        /* =========================================
           6. HEADER & NAVIGATION ULTIMATE
           ========================================= */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 64px;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--bg-header);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            z-index: var(--z-fixed);
            border-bottom: 1px solid var(--border);
            transition: all var(--transition-normal);
        }

        .logo-area {
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 800;
            font-size: 20px;
            color: var(--text-primary);
            text-decoration: none;
        }
        .logo-area i {
            color: var(--accent-main);
            font-size: 24px;
        }
        .logo-badge {
            background: var(--accent-gradient);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 700;
            margin-left: 8px;
        }

        .header-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        /* Notification Badge */
        .notification-badge {
            position: absolute;
            top: -2px;
            right: -2px;
            background: var(--danger);
            color: white;
            font-size: 10px;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            border: 2px solid var(--bg-header);
        }

        /* Bottom Navigation Enhanced */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 72px;
            background: var(--bg-header);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: space-around;
            align-items: center;
            z-index: var(--z-fixed);
            padding-bottom: var(--safe-bottom);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
            color: var(--text-secondary);
            font-size: 10px;
            font-weight: 600;
            background: none;
            border: none;
            cursor: pointer;
            flex: 1;
            height: 100%;
            padding: 8px 0;
            transition: all var(--transition-fast);
            position: relative;
            border-radius: 0;
        }
        .nav-item:hover {
            color: var(--text-primary);
            background: var(--bg-secondary);
        }
        .nav-item.active {
            color: var(--accent-main);
        }
        .nav-item.active::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 3px;
            background: var(--accent-main);
            border-radius: 0 0 3px 3px;
        }
        .nav-item i {
            font-size: 20px;
            margin-bottom: 2px;
        }
        .nav-badge {
            position: absolute;
            top: 8px;
            right: calc(50% - 20px);
            background: var(--danger);
            color: white;
            font-size: 9px;
            min-width: 16px;
            height: 16px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 4px;
            font-weight: 700;
        }

        /* Floating Action Button */
        .fab-container {
            position: fixed;
            bottom: 90px;
            right: 20px;
            z-index: var(--z-fixed);
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 12px;
        }

        .fab {
            width: 56px;
            height: 56px;
            border-radius: 18px;
            background: var(--accent-main);
            color: white;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            box-shadow: var(--shadow-lg);
            transition: all var(--transition-normal);
            position: relative;
        }
        .fab:hover {
            transform: translateY(-4px) scale(1.05);
            box-shadow: 0 16px 32px rgba(0, 171, 85, 0.3);
        }
        .fab:active {
            transform: translateY(-2px) scale(0.98);
        }
        .fab-primary {
            background: var(--accent-gradient);
        }
        .fab-secondary {
            width: 48px;
            height: 48px;
            background: var(--bg-card);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .fab-menu {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 8px;
            opacity: 0;
            transform: translateY(20px);
            transition: all var(--transition-normal);
            pointer-events: none;
        }
        .fab-menu.open {
            opacity: 1;
            transform: translateY(0);
            pointer-events: all;
        }

        /* =========================================
           7. CARDS & CONTAINERS ENHANCED
           ========================================= */
        .card {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow);
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--border);
            transition: all var(--transition-normal);
            position: relative;
            overflow: hidden;
        }
        .card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }
        .card.highlight {
            border-left: 4px solid var(--accent-main);
        }
        .card.warning {
            border-left: 4px solid var(--warning);
        }
        .card.danger {
            border-left: 4px solid var(--danger);
        }
        .card.success {
            border-left: 4px solid var(--success);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border);
        }
        .card-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .card-subtitle {
            font-size: 13px;
            color: var(--text-secondary);
            margin-top: 2px;
        }

        .card-actions {
            display: flex;
            gap: 8px;
        }

        .card-body {
            margin-bottom: 16px;
        }

        .card-footer {
            padding-top: 16px;
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* Glass Card */
        .card-glass {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        [data-theme="dark"] .card-glass {
            background: rgba(30, 41, 59, 0.3);
        }

        /* Gradient Card */
        .card-gradient {
            background: var(--accent-gradient);
            color: white;
            border: none;
        }
        .card-gradient .card-title,
        .card-gradient .card-subtitle,
        .card-gradient .stat-value,
        .card-gradient .stat-label {
            color: white !important;
        }

        /* =========================================
           8. STATS & METRICS ULTIMATE
           ========================================= */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }
        .stats-grid-micro { grid-template-columns: repeat(5, 1fr); }
        .stats-grid-compact { grid-template-columns: repeat(3, 1fr); }
        .stats-grid-expanded { grid-template-columns: repeat(4, 1fr); }

        .stat-box {
            background: var(--bg-secondary);
            border-radius: var(--radius);
            padding: 16px;
            text-align: center;
            position: relative;
            border: 1px solid var(--border);
            transition: all var(--transition-fast);
        }
        .stat-box:hover {
            background: var(--bg-tertiary);
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
        }
        .stat-box.highlight {
            background: var(--accent-gradient);
            color: white;
            border: none;
        }
        .stat-box.highlight .stat-label,
        .stat-box.highlight .stat-trend {
            color: rgba(255, 255, 255, 0.9) !important;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 800;
            margin-bottom: 4px;
            line-height: 1.2;
        }
        .stat-value.small { font-size: 20px; }
        .stat-value.large { font-size: 32px; }

        .stat-label {
            font-size: 12px;
            color: var(--text-secondary);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .stat-trend {
            font-size: 11px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            margin-top: 4px;
        }
        .trend-up { color: var(--success); }
        .trend-down { color: var(--danger); }
        .trend-neutral { color: var(--text-muted); }

        .stat-icon {
            position: absolute;
            top: 12px;
            right: 12px;
            font-size: 20px;
            opacity: 0.3;
        }
        .stat-box.highlight .stat-icon {
            opacity: 0.2;
            color: white;
        }

        /* Performance Meter */
        .performance-meter {
            height: 6px;
            background: var(--bg-tertiary);
            border-radius: 3px;
            margin-top: 8px;
            overflow: hidden;
        }
        .performance-fill {
            height: 100%;
            border-radius: 3px;
            background: var(--accent-gradient);
            transition: width 0.6s ease-out;
        }

        /* Risk Meter */
        .risk-meter-container {
            height: 8px;
            background: var(--bg-tertiary);
            border-radius: 4px;
            margin-top: 5px;
            overflow: hidden;
            display: flex;
        }
        .risk-segment {
            height: 100%;
            transition: all 0.3s ease;
        }
        .risk-low { background: var(--success); }
        .risk-medium { background: var(--warning); }
        .risk-high { background: var(--danger); }

        /* =========================================
           9. UI COMPONENTS ENHANCED
           ========================================= */
        /* Buttons Ultimate */
        .btn {
            height: 48px;
            padding: 0 24px;
            border-radius: var(--radius);
            border: none;
            font-weight: 700;
            font-size: 14px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all var(--transition-fast);
            position: relative;
            overflow: hidden;
        }
        .btn:active {
            transform: translateY(2px);
        }
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        .btn-primary {
            background: var(--accent-main);
            color: white;
            box-shadow: 0 4px 12px rgba(0, 171, 85, 0.3);
        }
        .btn-primary:hover {
            background: var(--success-dark);
            box-shadow: 0 6px 16px rgba(0, 171, 85, 0.4);
        }

        .btn-secondary {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }
        .btn-secondary:hover {
            background: var(--bg-tertiary);
            border-color: var(--accent-main);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--border);
            color: var(--text-primary);
        }
        .btn-outline:hover {
            border-color: var(--accent-main);
            color: var(--accent-main);
        }

        .btn-ghost {
            background: rgba(145, 158, 171, 0.08);
            color: var(--text-primary);
            border: 1px solid transparent;
        }
        .btn-ghost:hover {
            background: rgba(145, 158, 171, 0.16);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }
        .btn-danger:hover {
            background: var(--danger-dark);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-warning {
            background: var(--warning);
            color: #1E293B;
        }

        .btn-sm {
            height: 32px;
            padding: 0 12px;
            font-size: 13px;
            border-radius: var(--radius-sm);
        }

        .btn-lg {
            height: 56px;
            padding: 0 32px;
            font-size: 16px;
            border-radius: var(--radius-lg);
        }

        .btn-block {
            width: 100%;
        }

        .btn-icon {
            width: 40px;
            height: 40px;
            padding: 0;
            border-radius: 50%;
            justify-content: center;
        }

        .btn-loading {
            pointer-events: none;
            opacity: 0.8;
        }
        .btn-loading::after {
            content: '';
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 0.8s linear infinite;
            margin-left: 8px;
        }
        .btn-secondary.btn-loading::after {
            border: 2px solid rgba(0, 0, 0, 0.1);
            border-top-color: var(--text-primary);
        }

        /* Icon Button */
        .icon-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            font-size: 18px;
            cursor: pointer;
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .icon-btn:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }
        .icon-btn.active {
            color: var(--accent-main);
            background: var(--success-light);
        }
        .icon-btn-danger:hover {
            color: var(--danger);
            background: var(--danger-light);
        }

        /* Inputs & Forms Enhanced */
        .form-group {
            margin-bottom: 20px;
        }
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
        }
        .form-label.required::after {
            content: ' *';
            color: var(--danger);
        }

        .input-group {
            position: relative;
            display: flex;
            align-items: center;
        }
        .input-group .input {
            flex: 1;
            padding-left: 40px;
        }
        .input-group .input-icon {
            position: absolute;
            left: 12px;
            color: var(--text-muted);
            pointer-events: none;
        }

        .input {
            width: 100%;
            height: 48px;
            padding: 0 16px;
            border-radius: var(--radius);
            border: 1px solid var(--border);
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 15px;
            transition: all var(--transition-fast);
        }
        .input:focus {
            border-color: var(--accent-main);
            outline: none;
            box-shadow: 0 0 0 3px rgba(0, 171, 85, 0.1);
        }
        .input:disabled {
            background: var(--bg-secondary);
            color: var(--text-muted);
            cursor: not-allowed;
        }
        .input.error {
            border-color: var(--danger);
            box-shadow: 0 0 0 3px rgba(255, 72, 66, 0.1);
        }
        .input.success {
            border-color: var(--success);
        }

        .textarea {
            min-height: 100px;
            padding: 12px 16px;
            resize: vertical;
            font-family: inherit;
        }

        .select {
            appearance: none;
            background-image: url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%2364748B'%3E%3Cpath d='M4 6l4 4 4-4z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 16px;
            padding-right: 40px;
        }

        .form-error {
            color: var(--danger);
            font-size: 12px;
            margin-top: 4px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .form-success {
            color: var(--success);
            font-size: 12px;
            margin-top: 4px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .form-hint {
            color: var(--text-muted);
            font-size: 12px;
            margin-top: 4px;
        }

        /* Checkbox & Radio Custom */
        .checkbox-container,
        .radio-container {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            user-select: none;
        }
        .checkbox-input,
        .radio-input {
            display: none;
        }
        .checkbox-custom {
            width: 20px;
            height: 20px;
            border: 2px solid var(--border);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-fast);
        }
        .checkbox-input:checked + .checkbox-custom {
            background: var(--accent-main);
            border-color: var(--accent-main);
        }
        .checkbox-input:checked + .checkbox-custom::after {
            content: '✓';
            color: white;
            font-size: 12px;
            font-weight: bold;
        }
        .radio-custom {
            width: 20px;
            height: 20px;
            border: 2px solid var(--border);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-fast);
        }
        .radio-input:checked + .radio-custom {
            border-color: var(--accent-main);
        }
        .radio-input:checked + .radio-custom::after {
            content: '';
            width: 10px;
            height: 10px;
            background: var(--accent-main);
            border-radius: 50%;
        }

        /* Tabs Enhanced */
        .tabs {
            display: flex;
            border-bottom: 1px solid var(--border);
            margin-bottom: 20px;
            overflow-x: auto;
            scrollbar-width: none;
        }
        .tabs::-webkit-scrollbar {
            display: none;
        }
        .tab {
            padding: 12px 20px;
            background: none;
            border: none;
            color: var(--text-secondary);
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all var(--transition-fast);
            white-space: nowrap;
            flex-shrink: 0;
        }
        .tab:hover {
            color: var(--text-primary);
        }
        .tab.active {
            color: var(--accent-main);
            border-bottom-color: var(--accent-main);
        }
        .tab-badge {
            background: var(--bg-secondary);
            color: var(--text-secondary);
            font-size: 11px;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: 6px;
        }
        .tab.active .tab-badge {
            background: var(--accent-main);
            color: white;
        }

        /* Badges */
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .badge-success {
            background: var(--success-light);
            color: var(--success);
        }
        .badge-danger {
            background: var(--danger-light);
            color: var(--danger);
        }
        .badge-warning {
            background: var(--warning-light);
            color: #E6B400;
        }
        .badge-info {
            background: var(--info-light);
            color: var(--info);
        }
        .badge-primary {
            background: rgba(0, 171, 85, 0.12);
            color: var(--accent-main);
        }
        .badge-outline {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-secondary);
        }

        /* Tags System */
        .tags-container {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 8px;
        }
        .tag-pill {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            cursor: pointer;
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .tag-pill:hover {
            background: var(--bg-tertiary);
        }
        .tag-pill.selected {
            background: var(--accent-main);
            color: white;
            border-color: var(--accent-main);
        }
        .tag-pill i {
            font-size: 10px;
        }

        /* =========================================
           10. TRADE SPECIFIC COMPONENTS
           ========================================= */
        /* Trade List Ultimate */
        .trade-list {
            display: flex;
            flex-direction: column;
            gap: 0;
        }

        .trade-item {
            padding: 16px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: all var(--transition-fast);
            position: relative;
        }
        .trade-item:hover {
            background: var(--bg-secondary);
        }
        .trade-item:active {
            background: var(--bg-tertiary);
        }
        .trade-item.favorite {
            background: linear-gradient(90deg, rgba(255,215,0,0.05) 0%, transparent 100%);
        }
        .trade-item.favorite::before {
            content: '⭐';
            position: absolute;
            left: 4px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 12px;
        }

        .trade-main {
            flex: 1;
            min-width: 0;
        }

        .trade-symbol {
            font-weight: 700;
            font-size: 15px;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .trade-symbol .side-indicator {
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 700;
        }
        .trade-symbol .side-indicator.long {
            background: var(--success-light);
            color: var(--success);
        }
        .trade-symbol .side-indicator.short {
            background: var(--danger-light);
            color: var(--danger);
        }

        .trade-details {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 4px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-items: center;
        }

        .trade-meta {
            font-size: 11px;
            color: var(--text-muted);
            display: flex;
            gap: 8px;
            align-items: center;
            flex-wrap: wrap;
        }

        .trade-pnl {
            text-align: right;
            font-weight: 700;
            font-size: 16px;
            min-width: 100px;
        }
        .trade-pnl.positive { color: var(--success); }
        .trade-pnl.negative { color: var(--danger); }
        .trade-pnl.neutral { color: var(--text-secondary); }

        .trade-actions {
            display: flex;
            gap: 4px;
            margin-left: 12px;
            opacity: 0;
            transition: opacity var(--transition-fast);
        }
        .trade-item:hover .trade-actions {
            opacity: 1;
        }

        /* Emotion Selector Enhanced */
        .emotion-selector {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            padding: 16px;
            background: var(--bg-secondary);
            border-radius: var(--radius);
        }
        .emotion-radio {
            display: none;
        }
        .emotion-label {
            font-size: 32px;
            cursor: pointer;
            opacity: 0.4;
            transition: all var(--transition-normal);
            filter: grayscale(1);
            transform: scale(0.9);
            position: relative;
        }
        .emotion-label:hover {
            opacity: 0.7;
            filter: grayscale(0.5);
            transform: scale(1.1);
        }
        .emotion-radio:checked + .emotion-label {
            opacity: 1;
            filter: grayscale(0);
            transform: scale(1.2);
        }
        .emotion-label::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: -24px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 11px;
            color: var(--text-secondary);
            white-space: nowrap;
            opacity: 0;
            transition: opacity var(--transition-fast);
        }
        .emotion-label:hover::after {
            opacity: 1;
        }

        /* Strategy Selector */
        .strategy-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 8px;
            margin-bottom: 16px;
        }
        .strategy-option {
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: var(--radius);
            text-align: center;
            cursor: pointer;
            transition: all var(--transition-fast);
            background: var(--bg-secondary);
        }
        .strategy-option:hover {
            border-color: var(--accent-main);
            background: var(--bg-tertiary);
        }
        .strategy-option.selected {
            border-color: var(--accent-main);
            background: var(--accent-main);
            color: white;
        }
        .strategy-icon {
            font-size: 20px;
            margin-bottom: 8px;
            display: block;
        }

        /* =========================================
           11. CALENDAR & HEATMAP ULTIMATE
           ========================================= */
        .calendar-container {
            margin-top: 16px;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
            margin-top: 10px;
        }

        .cal-day-header {
            font-size: 11px;
            text-align: center;
            color: var(--text-secondary);
            padding: 8px 0;
            font-weight: 600;
            text-transform: uppercase;
        }

        .cal-day {
            aspect-ratio: 1;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: var(--bg-secondary);
            font-size: 12px;
            font-weight: 600;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            cursor: pointer;
            transition: all var(--transition-fast);
        }
        .cal-day:hover {
            transform: scale(1.05);
            z-index: 1;
            box-shadow: var(--shadow-sm);
        }
        .cal-day.today {
            border-color: var(--accent-main);
            background: var(--accent-main);
            color: white;
        }
        .cal-day.has-profit {
            background: linear-gradient(135deg, var(--success) 0%, var(--success-dark) 100%);
            color: white;
            border-color: var(--success);
        }
        .cal-day.has-loss {
            background: linear-gradient(135deg, var(--danger) 0%, var(--danger-dark) 100%);
            color: white;
            border-color: var(--danger);
        }
        .cal-day.has-mixed {
            background: linear-gradient(135deg, var(--warning) 0%, #E6B400 100%);
            color: #1E293B;
            border-color: var(--warning);
        }
        .cal-day.empty {
            background: transparent;
            border: none;
            cursor: default;
        }
        .cal-day.empty:hover {
            transform: none;
            box-shadow: none;
        }

        .cal-day-stats {
            font-size: 9px;
            opacity: 0.8;
            margin-top: 2px;
        }

        /* Heatmap Ultimate */
        .heatmap-container {
            overflow-x: auto;
            padding: 16px 0;
            margin: 16px 0;
        }

        .heatmap-grid {
            display: grid;
            grid-template-columns: 60px repeat(24, 1fr);
            gap: 2px;
            min-width: 1200px;
        }

        .heatmap-hour-label {
            font-size: 10px;
            color: var(--text-secondary);
            text-align: center;
            padding: 4px;
            font-weight: 600;
        }

        .heatmap-day-label {
            font-size: 11px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 8px;
            font-weight: 600;
        }

        .heatmap-cell {
            aspect-ratio: 1;
            border-radius: 3px;
            border: 1px solid var(--border);
            transition: all var(--transition-fast);
            position: relative;
            cursor: pointer;
        }
        .heatmap-cell:hover {
            transform: scale(1.1);
            z-index: 1;
        }
        .heatmap-intensity-0 { background: var(--bg-secondary); }
        .heatmap-intensity-1 { background: rgba(0, 171, 85, 0.1); }
        .heatmap-intensity-2 { background: rgba(0, 171, 85, 0.3); }
        .heatmap-intensity-3 { background: rgba(0, 171, 85, 0.5); }
        .heatmap-intensity-4 { background: rgba(0, 171, 85, 0.7); }
        .heatmap-intensity-5 { background: rgba(0, 171, 85, 0.9); }

        /* GitHub Style Heatmap */
        .github-heatmap {
            display: flex;
            gap: 2px;
            padding: 16px;
            background: var(--bg-secondary);
            border-radius: var(--radius);
            overflow-x: auto;
        }
        .github-heatmap-column {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }
        .github-heatmap-cell {
            width: 12px;
            height: 12px;
            border-radius: 2px;
            background: var(--bg-tertiary);
            position: relative;
        }
        .github-heatmap-cell[data-count="1"] { background: rgba(0, 171, 85, 0.2); }
        .github-heatmap-cell[data-count="2"] { background: rgba(0, 171, 85, 0.4); }
        .github-heatmap-cell[data-count="3"] { background: rgba(0, 171, 85, 0.6); }
        .github-heatmap-cell[data-count="4"] { background: rgba(0, 171, 85, 0.8); }
        .github-heatmap-cell[data-count="5"] { background: rgba(0, 171, 85, 1); }

        /* =========================================
           12. CHARTS & GRAPHS ULTIMATE
           ========================================= */
        .chart-container {
            position: relative;
            height: 200px;
            margin: 16px 0;
        }
        .chart-container-sm { height: 150px; }
        .chart-container-lg { height: 250px; }
        .chart-container-xl { height: 300px; }
        .chart-container-full { height: 400px; }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .chart-legend {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
            margin-top: 16px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: var(--text-secondary);
        }
        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 2px;
        }

        /* Mini Charts */
        .mini-chart {
            height: 40px;
            width: 100%;
            position: relative;
        }
        .mini-chart-line {
            fill: none;
            stroke: var(--accent-main);
            stroke-width: 2;
        }
        .mini-chart-area {
            fill: rgba(0, 171, 85, 0.1);
        }

        /* =========================================
           13. MODALS & OVERLAYS ULTIMATE
           ========================================= */
        .modal-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            z-index: var(--z-modal-backdrop);
            display: none;
            align-items: center;
            justify-content: center;
            padding: 16px;
            animation: fadeIn 0.3s ease-out;
        }
        .modal-backdrop.active {
            display: flex;
        }

        .modal {
            background: var(--bg-card);
            width: 100%;
            max-width: 600px;
            border-radius: var(--radius-lg);
            max-height: 90vh;
            overflow-y: auto;
            animation: slideInRight 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            border: 1px solid var(--border);
            box-shadow: var(--shadow-lg);
        }
        .modal-sm { max-width: 400px; }
        .modal-lg { max-width: 800px; }
        .modal-xl { max-width: 1000px; }

        .modal-header {
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            background: var(--bg-card);
            z-index: 1;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .modal-body {
            padding: 20px;
        }

        .modal-footer {
            padding: 20px;
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        /* Slide Up Modal (Mobile) */
        @media (max-width: 768px) {
            .modal-backdrop {
                align-items: flex-end;
            }
            .modal {
                border-radius: var(--radius-lg) var(--radius-lg) 0 0;
                max-height: 80vh;
                animation: slideInUp 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            }
        }

        /* Quick Actions Modal */
        .quick-actions-modal .modal-body {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
        }
        .quick-action-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 12px;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            background: var(--bg-secondary);
            cursor: pointer;
            transition: all var(--transition-fast);
        }
        .quick-action-btn:hover {
            border-color: var(--accent-main);
            background: var(--bg-tertiary);
            transform: translateY(-2px);
        }
        .quick-action-icon {
            font-size: 24px;
            margin-bottom: 12px;
            color: var(--accent-main);
        }
        .quick-action-label {
            font-size: 13px;
            font-weight: 600;
            text-align: center;
        }

        /* =========================================
           14. TOAST & NOTIFICATION SYSTEM
           ========================================= */
        .toast-container {
            position: fixed;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            z-index: var(--z-toast);
            display: flex;
            flex-direction: column;
            gap: 8px;
            width: auto;
            max-width: 400px;
            pointer-events: none;
        }

        .toast {
            background: var(--bg-card);
            padding: 12px 20px;
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 600;
            font-size: 14px;
            border: 1px solid var(--border);
            animation: slideInRight 0.3s ease-out;
            pointer-events: all;
            border-left: 4px solid var(--accent-main);
        }
        .toast.success { border-left-color: var(--success); }
        .toast.error { border-left-color: var(--danger); }
        .toast.warning { border-left-color: var(--warning); }
        .toast.info { border-left-color: var(--info); }

        .toast-icon {
            font-size: 18px;
        }
        .toast-success .toast-icon { color: var(--success); }
        .toast-error .toast-icon { color: var(--danger); }
        .toast-warning .toast-icon { color: var(--warning); }
        .toast-info .toast-icon { color: var(--info); }

        .toast-close {
            margin-left: auto;
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 16px;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
        }
        .toast-close:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        /* Notification Center */
        .notification-center {
            position: fixed;
            top: 70px;
            right: 20px;
            width: 320px;
            max-height: 400px;
            overflow-y: auto;
            background: var(--bg-card);
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border);
            z-index: var(--z-popover);
            display: none;
        }
        .notification-center.active {
            display: block;
            animation: slideInRight 0.3s ease-out;
        }

        .notification-header {
            padding: 16px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .notification-list {
            display: flex;
            flex-direction: column;
        }

        .notification-item {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            transition: background var(--transition-fast);
        }
        .notification-item:hover {
            background: var(--bg-secondary);
        }
        .notification-item.unread {
            background: var(--info-light);
        }

        .notification-title {
            font-weight: 600;
            font-size: 13px;
            margin-bottom: 4px;
        }

        .notification-message {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }

        .notification-time {
            font-size: 11px;
            color: var(--text-muted);
        }

        /* =========================================
           15. LOGIN & AUTH SCREENS
           ========================================= */
        .login-overlay {
            position: fixed;
            inset: 0;
            background: var(--bg-primary);
            z-index: var(--z-max);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 30px;
            animation: fadeIn 0.5s ease-out;
        }

        .login-container {
            width: 100%;
            max-width: 400px;
            animation: slideInUp 0.5s ease-out;
        }

        .login-logo {
            text-align: center;
            margin-bottom: 40px;
        }
        .login-logo i {
            font-size: 64px;
            color: var(--accent-main);
            margin-bottom: 16px;
            animation: float 3s ease-in-out infinite;
        }
        .login-logo h1 {
            font-size: 32px;
            font-weight: 800;
            margin-bottom: 8px;
            background: var(--accent-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .login-logo p {
            color: var(--text-secondary);
            font-size: 16px;
        }

        .login-card {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: 30px;
            border: 1px solid var(--border);
            box-shadow: var(--shadow-lg);
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 24px;
            border-bottom: 1px solid var(--border);
        }
        .auth-tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            border: none;
            background: none;
            color: var(--text-secondary);
            font-weight: 600;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all var(--transition-fast);
        }
        .auth-tab.active {
            color: var(--accent-main);
            border-bottom-color: var(--accent-main);
        }

        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .auth-divider {
            text-align: center;
            margin: 20px 0;
            color: var(--text-secondary);
            position: relative;
        }
        .auth-divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: var(--border);
        }
        .auth-divider span {
            background: var(--bg-card);
            padding: 0 16px;
            position: relative;
            font-size: 13px;
        }

        /* =========================================
           16. DASHBOARD WIDGETS
           ========================================= */
        .dashboard-widgets {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }

        .widget {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: 20px;
            border: 1px solid var(--border);
            transition: all var(--transition-normal);
        }
        .widget:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }

        .widget-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .widget-title {
            font-size: 14px;
            font-weight: 700;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .widget-content {
            margin-top: 16px;
        }

        /* Performance Widget */
        .performance-widget {
            grid-column: span 2;
        }

        /* Quick Stats Widget */
        .quick-stats-widget .stats-grid {
            grid-template-columns: repeat(4, 1fr);
        }

        /* Market Overview Widget */
        .market-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
        }
        .market-item {
            padding: 12px;
            border-radius: var(--radius);
            background: var(--bg-secondary);
            border: 1px solid var(--border);
        }
        .market-symbol {
            font-weight: 600;
            font-size: 13px;
            margin-bottom: 4px;
        }
        .market-price {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 4px;
        }
        .market-change {
            font-size: 12px;
            font-weight: 600;
        }
        .market-change.positive { color: var(--success); }
        .market-change.negative { color: var(--danger); }

        /* =========================================
           17. LOADING & SKELETON STATES
           ========================================= */
        .skeleton {
            background: linear-gradient(90deg, var(--bg-secondary) 25%, var(--border) 50%, var(--bg-secondary) 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: var(--radius);
        }

        .skeleton-text {
            height: 16px;
            margin-bottom: 8px;
            border-radius: 4px;
        }
        .skeleton-text-sm { height: 12px; }
        .skeleton-text-lg { height: 24px; }

        .skeleton-card {
            height: 200px;
            margin-bottom: 16px;
            border-radius: var(--radius);
        }

        .skeleton-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
        }

        .loading-overlay {
            position: absolute;
            inset: 0;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            border-radius: inherit;
        }
        [data-theme="dark"] .loading-overlay {
            background: rgba(15, 23, 42, 0.8);
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border);
            border-top-color: var(--accent-main);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        /* =========================================
           18. UTILITY CLASSES
           ========================================= */
        /* Text Utilities */
        .text-truncate {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .text-uppercase { text-transform: uppercase; }
        .text-lowercase { text-transform: lowercase; }
        .text-capitalize { text-transform: capitalize; }

        .text-xs { font-size: 11px; }
        .text-sm { font-size: 13px; }
        .text-base { font-size: 14px; }
        .text-lg { font-size: 16px; }
        .text-xl { font-size: 18px; }
        .text-2xl { font-size: 20px; }
        .text-3xl { font-size: 24px; }

        .font-light { font-weight: 300; }
        .font-normal { font-weight: 400; }
        .font-medium { font-weight: 500; }
        .font-semibold { font-weight: 600; }
        .font-bold { font-weight: 700; }
        .font-extrabold { font-weight: 800; }

        .text-primary { color: var(--text-primary); }
        .text-secondary { color: var(--text-secondary); }
        .text-muted { color: var(--text-muted); }
        .text-success { color: var(--success); }
        .text-danger { color: var(--danger); }
        .text-warning { color: var(--warning); }
        .text-info { color: var(--info); }
        .text-accent { color: var(--accent-main); }

        /* Spacing Utilities */
        .m-0 { margin: 0; }
        .m-1 { margin: 4px; }
        .m-2 { margin: 8px; }
        .m-3 { margin: 16px; }
        .m-4 { margin: 24px; }
        .m-auto { margin: auto; }

        .mt-0 { margin-top: 0; }
        .mt-1 { margin-top: 4px; }
        .mt-2 { margin-top: 8px; }
        .mt-3 { margin-top: 16px; }
        .mt-4 { margin-top: 24px; }
        .mt-auto { margin-top: auto; }

        .mb-0 { margin-bottom: 0; }
        .mb-1 { margin-bottom: 4px; }
        .mb-2 { margin-bottom: 8px; }
        .mb-3 { margin-bottom: 16px; }
        .mb-4 { margin-bottom: 24px; }
        .mb-auto { margin-bottom: auto; }

        .p-0 { padding: 0; }
        .p-1 { padding: 4px; }
        .p-2 { padding: 8px; }
        .p-3 { padding: 16px; }
        .p-4 { padding: 24px; }

        .pt-0 { padding-top: 0; }
        .pt-1 { padding-top: 4px; }
        .pt-2 { padding-top: 8px; }
        .pt-3 { padding-top: 16px; }
        .pt-4 { padding-top: 24px; }

        .pb-0 { padding-bottom: 0; }
        .pb-1 { padding-bottom: 4px; }
        .pb-2 { padding-bottom: 8px; }
        .pb-3 { padding-bottom: 16px; }
        .pb-4 { padding-bottom: 24px; }

        /* Display Utilities */
        .d-none { display: none !important; }
        .d-block { display: block !important; }
        .d-flex { display: flex !important; }
        .d-grid { display: grid !important; }
        .d-inline { display: inline !important; }
        .d-inline-block { display: inline-block !important; }

        /* Position Utilities */
        .position-relative { position: relative; }
        .position-absolute { position: absolute; }
        .position-fixed { position: fixed; }
        .position-sticky { position: sticky; }

        /* Border Utilities */
        .border { border: 1px solid var(--border); }
        .border-top { border-top: 1px solid var(--border); }
        .border-bottom { border-bottom: 1px solid var(--border); }
        .border-left { border-left: 1px solid var(--border); }
        .border-right { border-right: 1px solid var(--border); }
        .border-0 { border: none; }

        .rounded { border-radius: var(--radius); }
        .rounded-sm { border-radius: var(--radius-sm); }
        .rounded-lg { border-radius: var(--radius-lg); }
        .rounded-full { border-radius: 9999px; }

        /* Shadow Utilities */
        .shadow-none { box-shadow: none; }
        .shadow-sm { box-shadow: var(--shadow-sm); }
        .shadow { box-shadow: var(--shadow); }
        .shadow-lg { box-shadow: var(--shadow-lg); }

        /* Background Utilities */
        .bg-primary { background: var(--bg-primary); }
        .bg-secondary { background: var(--bg-secondary); }
        .bg-tertiary { background: var(--bg-tertiary); }
        .bg-card { background: var(--bg-card); }
        .bg-accent { background: var(--accent-main); }
        .bg-success { background: var(--success); }
        .bg-danger { background: var(--danger); }
        .bg-warning { background: var(--warning); }
        .bg-info { background: var(--info); }

        /* Width & Height Utilities */
        .w-25 { width: 25%; }
        .w-50 { width: 50%; }
        .w-75 { width: 75%; }
        .w-100 { width: 100%; }
        .w-auto { width: auto; }

        .h-25 { height: 25%; }
        .h-50 { height: 50%; }
        .h-75 { height: 75%; }
        .h-100 { height: 100%; }
        .h-auto { height: auto; }

        .vw-100 { width: 100vw; }
        .vh-100 { height: 100vh; }

        /* Opacity Utilities */
        .opacity-0 { opacity: 0; }
        .opacity-25 { opacity: 0.25; }
        .opacity-50 { opacity: 0.5; }
        .opacity-75 { opacity: 0.75; }
        .opacity-100 { opacity: 1; }

        /* Z-index Utilities */
        .z-0 { z-index: 0; }
        .z-10 { z-index: 10; }
        .z-20 { z-index: 20; }
        .z-30 { z-index: 30; }
        .z-40 { z-index: 40; }
        .z-50 { z-index: 50; }
        .z-auto { z-index: auto; }

        /* =========================================
           19. RESPONSIVE BREAKPOINTS
           ========================================= */
        /* Extra small devices (phones, 600px and down) */
        @media only screen and (max-width: 600px) {
            .main-container {
                padding: 70px 12px 100px 12px;
            }
            .header {
                padding: 0 12px;
            }
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            .stats-grid-micro {
                grid-template-columns: repeat(3, 1fr);
            }
            .card {
                padding: 16px;
            }
            .modal {
                border-radius: var(--radius-lg) var(--radius-lg) 0 0;
            }
            .dashboard-widgets {
                grid-template-columns: 1fr;
            }
            .performance-widget {
                grid-column: span 1;
            }
        }

        /* Small devices (portrait tablets and large phones, 600px and up) */
        @media only screen and (min-width: 600px) {
            .main-container {
                padding: 80px 16px 100px 16px;
            }
        }

        /* Medium devices (landscape tablets, 768px and up) */
        @media only screen and (min-width: 768px) {
            .main-container {
                padding: 80px 24px 100px 24px;
            }
            .stats-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            .stats-grid-micro {
                grid-template-columns: repeat(5, 1fr);
            }
        }

        /* Large devices (laptops/desktops, 992px and up) */
        @media only screen and (min-width: 992px) {
            .main-container {
                padding: 80px 32px 100px 32px;
            }
            .dashboard-widgets {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Extra large devices (large laptops and desktops, 1200px and up) */
        @media only screen and (min-width: 1200px) {
            .main-container {
                padding: 80px 40px 100px 40px;
            }
            .dashboard-widgets {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        /* Print styles */
        @media print {
            .header,
            .bottom-nav,
            .fab-container,
            .notification-center,
            .modal-backdrop {
                display: none !important;
            }
            .main-container {
                padding: 20px;
            }
            body {
                background: white;
                color: black;
            }
            .card {
                box-shadow: none;
                border: 1px solid #ddd;
                break-inside: avoid;
            }
        }

        /* =========================================
           20. CUSTOM SCROLLBAR
           ========================================= */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: var(--bg-secondary);
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-muted);
        }

        /* Firefox */
        * {
            scrollbar-width: thin;
            scrollbar-color: var(--border) var(--bg-secondary);
        }

        /* =========================================
           21. ACCESSIBILITY
           ========================================= */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* Focus styles for keyboard navigation */
        :focus-visible {
            outline: 2px solid var(--accent-main);
            outline-offset: 2px;
        }

        /* High contrast mode support */
        @media (prefers-contrast: high) {
            :root {
                --border: #000000;
                --shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
            }
            .card {
                border: 2px solid var(--border);
            }
        }

        /* Reduced motion support */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
                scroll-behavior: auto !important;
            }
        }

        /* =========================================
           22. TRADINGVIEW SPECIFIC
           ========================================= */
        .tradingview-widget-container {
            border-radius: var(--radius);
            overflow: hidden;
            margin-bottom: 20px;
            border: 1px solid var(--border);
        }

        /* =========================================
           23. EDUCATIONAL CONTENT
           ========================================= */
        .educational-tip {
            background: var(--info-light);
            border-left: 4px solid var(--info);
            padding: 12px 16px;
            border-radius: var(--radius-sm);
            margin-bottom: 16px;
        }
        .educational-tip .tip-title {
            font-weight: 600;
            color: var(--info);
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .educational-tip .tip-content {
            font-size: 13px;
            color: var(--text-secondary);
        }

        /* =========================================
           24. ONBOARDING TOUR
           ========================================= */
        .onboarding-tour {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: var(--z-max);
            display: none;
            align-items: center;
            justify-content: center;
        }
        .onboarding-tour.active {
            display: flex;
        }
        .tour-step {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: 24px;
            max-width: 400px;
            margin: 20px;
            border: 1px solid var(--border);
            box-shadow: var(--shadow-lg);
            position: relative;
        }
        .tour-content {
            margin-bottom: 20px;
        }
        .tour-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .tour-indicator {
            display: flex;
            gap: 6px;
            justify-content: center;
            margin-top: 16px;
        }
        .tour-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--border);
        }
        .tour-dot.active {
            background: var(--accent-main);
        }

        /* =========================================
           25. AI RECOMMENDATIONS
           ========================================= */
        .ai-recommendation {
            background: linear-gradient(135deg, rgba(0, 171, 85, 0.05) 0%, rgba(0, 171, 85, 0.1) 100%);
            border: 1px solid rgba(0, 171, 85, 0.2);
            border-radius: var(--radius);
            padding: 16px;
            margin-bottom: 16px;
        }
        .ai-recommendation-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
        }
        .ai-recommendation-icon {
            color: var(--accent-main);
            font-size: 18px;
        }
        .ai-recommendation-title {
            font-weight: 700;
            color: var(--text-primary);
        }
        .ai-recommendation-confidence {
            margin-left: auto;
            font-size: 12px;
            color: var(--text-muted);
        }
        .ai-recommendation-content {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.5;
        }
        .ai-recommendation-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }
    </style>
</head>
<body class="">

    <!-- Login Screen -->
    <div class="login-overlay" id="loginScreen">
        <div class="login-container">
            <div class="login-logo">
                <i class="fas fa-layer-group"></i>
                <h1>TITAN Pro</h1>
                <p>Le journal de trading ultime pour les traders sérieux</p>
            </div>
            
            <div class="login-card">
                <div class="auth-tabs">
                    <button class="auth-tab active" data-tab="login">Connexion</button>
                    <button class="auth-tab" data-tab="signup">Inscription</button>
                </div>
                
                <form class="auth-form" id="authForm">
                    <div class="form-group">
                        <label class="form-label" for="authEmail">Email</label>
                        <input type="email" class="input" id="authEmail" placeholder="votre@email.com" required>
                        <div class="form-error" id="emailError"></div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="authPassword">Mot de passe</label>
                        <input type="password" class="input" id="authPassword" placeholder="••••••••" required minlength="6">
                        <div class="form-error" id="passwordError"></div>
                    </div>
                    
                    <div class="form-group" id="authConfirmGroup" style="display: none;">
                        <label class="form-label" for="authConfirmPassword">Confirmer le mot de passe</label>
                        <input type="password" class="input" id="authConfirmPassword" placeholder="••••••••" minlength="6">
                        <div class="form-error" id="confirmError"></div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary btn-block" id="authSubmit">
                        Se connecter
                    </button>
                </form>
                
                <div class="auth-divider">
                    <span>Ou continuer avec</span>
                </div>
                
                <div class="auth-form">
                    <button type="button" class="btn btn-outline btn-block" id="googleLogin">
                        <i class="fab fa-google"></i>
                        Google
                    </button>
                    
                    <button type="button" class="btn btn-ghost btn-block" id="anonymousLogin">
                        <i class="fas fa-user-secret"></i>
                        Mode Invité (Offline)
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Exit Concentration Button -->
    <button id="exit-concentration-btn" onclick="toggleConcentrationMode()">
        <i class="fas fa-eye-slash"></i> Quitter Mode Focus
    </button>

    <!-- Header -->
    <header class="header">
        <div class="logo-area">
            <i class="fas fa-cube"></i>
            <span>TITAN</span>
            <span class="logo-badge">PRO</span>
        </div>
        
        <div class="header-actions">
            <button class="icon-btn" onclick="toggleGhostMode()" title="Mode Discret" id="ghostToggle">
                <i class="fas fa-eye-slash" id="ghostIcon"></i>
            </button>
            <button class="icon-btn" onclick="toggleConcentrationMode()" title="Mode Concentration" id="concentrationToggle">
                <i class="fas fa-expand"></i>
            </button>
            <button class="icon-btn" onclick="toggleTheme()" title="Changer le thème" id="themeToggle">
                <i class="fas fa-moon" id="themeIcon"></i>
            </button>
            <button class="icon-btn" onclick="toggleNotificationCenter()" title="Notifications" id="notificationToggle">
                <i class="fas fa-bell"></i>
                <span class="notification-badge" id="notificationCount">0</span>
            </button>
        </div>
    </header>

    <!-- Notification Center -->
    <div class="notification-center" id="notificationCenter">
        <div class="notification-header">
            <div class="card-title">Notifications</div>
            <button class="icon-btn" onclick="clearAllNotifications()">
                <i class="fas fa-trash"></i>
            </button>
        </div>
        <div class="notification-list" id="notificationList">
            <!-- Notifications will be populated here -->
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Main Content -->
    <div class="main-container" id="appContainer" style="display:none;">
        
        <!-- Dashboard Page -->
        <section id="page-dashboard" class="page active">
            <!-- Welcome Banner -->
            <div class="card card-gradient mb-4">
                <div class="flex items-center justify-between">
                    <div>
                        <h2 class="text-white text-2xl font-bold" id="welcomeMessage">Bon retour, Trader</h2>
                        <p class="text-white opacity-90" id="dashboardDate">Chargement...</p>
                    </div>
                    <div class="text-right">
                        <div class="text-white opacity-80 text-sm">Capital Total</div>
                        <div class="sensitive text-white text-3xl font-extrabold" id="totalCapital">€0.00</div>
                        <div class="flex items-center gap-4 mt-2">
                            <div>
                                <div class="text-white opacity-80 text-xs">P&L Journalier</div>
                                <div class="sensitive text-white font-bold" id="dailyPnl">+€0.00</div>
                            </div>
                            <div>
                                <div class="text-white opacity-80 text-xs">Win Streak</div>
                                <div class="text-white font-bold" id="winStreak">0 🔥</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Stats -->
            <div class="stats-grid stats-grid-micro mb-4">
                <div class="stat-box">
                    <div class="stat-value sensitive" id="winRate">0%</div>
                    <div class="stat-label">Win Rate</div>
                    <div class="stat-trend"><i class="fas fa-arrow-up trend-up"></i> <span id="winRateTrend">0%</span></div>
                </div>
                <div class="stat-box">
                    <div class="stat-value sensitive" id="profitFactor">0.00</div>
                    <div class="stat-label">Profit Factor</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value sensitive" id="avgRR">0.00</div>
                    <div class="stat-label">RR Moyen</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="maxDrawdown" style="color: var(--danger);">0%</div>
                    <div class="stat-label">Max DD</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="sharpeRatio">0.00</div>
                    <div class="stat-label">Sharpe</div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="card mb-4">
                <div class="card-header">
                    <div class="card-title"><i class="fas fa-bolt"></i> Actions Rapides</div>
                </div>
                <div class="grid grid-3 gap-3">
                    <button class="btn btn-outline" onclick="openTradeModal()">
                        <i class="fas fa-plus"></i> Nouveau Trade
                    </button>
                    <button class="btn btn-outline" onclick="quickCalculate()">
                        <i class="fas fa-calculator"></i> Calculateur
                    </button>
                    <button class="btn btn-outline" onclick="showPage('page-analytics')">
                        <i class="fas fa-chart-bar"></i> Analytics
                    </button>
                    <button class="btn btn-outline" onclick="exportQuickStats()">
                        <i class="fas fa-file-export"></i> Exporter
                    </button>
                    <button class="btn btn-outline" onclick="showDailySummary()">
                        <i class="fas fa-calendar-day"></i> Aujourd'hui
                    </button>
                    <button class="btn btn-outline" onclick="backupData()">
                        <i class="fas fa-cloud-upload-alt"></i> Sauvegarder
                    </button>
                </div>
            </div>

            <!-- Performance Charts -->
            <div class="grid grid-2 gap-4 mb-4">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title"><i class="fas fa-chart-line"></i> Courbe de Capital</div>
                        <select class="select" id="equityChartPeriod" onchange="updateEquityChart()">
                            <option value="7d">7 jours</option>
                            <option value="30d">30 jours</option>
                            <option value="90d">90 jours</option>
                            <option value="1y">1 an</option>
                            <option value="all">Tout</option>
                        </select>
                    </div>
                    <div class="chart-container-lg">
                        <canvas id="equityChart"></canvas>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-title"><i class="fas fa-chart-pie"></i> Distribution P&L</div>
                    </div>
                    <div class="chart-container-lg">
                        <canvas id="pnlDistributionChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Calendar & Heatmap -->
            <div class="grid grid-2 gap-4 mb-4">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title"><i class="fas fa-calendar"></i> Calendrier P&L</div>
                        <select id="calendarMonth" onchange="renderCalendar()" class="select"></select>
                    </div>
                    <div class="calendar-grid" id="calendarGrid"></div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-title"><i class="fas fa-fire"></i> Heatmap d'Activité</div>
                    </div>
                    <div class="github-heatmap" id="githubHeatmap"></div>
                </div>
            </div>

            <!-- Recent Trades -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title"><i class="fas fa-history"></i> Trades Récents</div>
                    <button class="btn btn-sm btn-outline" onclick="showPage('page-trades')">
                        Voir tout <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
                <div class="trade-list" id="recentTrades"></div>
            </div>

            <!-- AI Recommendations -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title"><i class="fas fa-robot"></i> Recommandations IA</div>
                </div>
                <div id="aiRecommendations">
                    <!-- AI recommendations will be loaded here -->
                </div>
            </div>
        </section>

        <!-- Trades Page -->
        <section id="page-trades" class="page">
            <div class="card">
                <div class="card-header">
                    <div class="card-title"><i class="fas fa-list-ul"></i> Journal des Trades</div>
                    <div class="flex items-center gap-2">
                        <div class="input-group" style="width: 200px;">
                            <i class="fas fa-search input-icon"></i>
                            <input type="text" id="searchTrades" class="input" placeholder="Rechercher...">
                        </div>
                        <button class="btn btn-primary btn-sm" onclick="openTradeModal()">
                            <i class="fas fa-plus"></i> Nouveau
                        </button>
                    </div>
                </div>

                <div class="tabs mb-4">
                    <button class="tab active" onclick="filterTrades('all')">Tous <span class="tab-badge" id="allCount">0</span></button>
                    <button class="tab" onclick="filterTrades('open')">Ouverts <span class="tab-badge" id="openCount">0</span></button>
                    <button class="tab" onclick="filterTrades('closed')">Fermés <span class="tab-badge" id="closedCount">0</span></button>
                    <button class="tab" onclick="filterTrades('winning')">Gagnants <span class="tab-badge" id="winningCount">0</span></button>
                    <button class="tab" onclick="filterTrades('losing')">Perdants <span class="tab-badge" id="losingCount">0</span></button>
                    <button class="tab" onclick="filterTrades('favorite')">Favoris <span class="tab-badge" id="favoriteCount">0</span></button>
                </div>

                <div class="trade-list" id="tradeListContainer">
                    <!-- Trades will be populated here -->
                </div>

                <div class="card-footer">
                    <div class="text-sm text-muted">
                        <span id="totalTradesCount">0</span> trades au total
                    </div>
                    <div class="flex gap-2">
                        <button class="btn btn-sm btn-outline" onclick="exportTradesCSV()">
                            <i class="fas fa-download"></i> CSV
                        </button>
                        <button class="btn btn-sm btn-outline" onclick="importTradesCSV()">
                            <i class="fas fa-upload"></i> Importer
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Analytics Page -->
        <section id="page-analytics" class="page">
            <div class="card mb-4">
                <div class="card-header">
                    <div class="card-title"><i class="fas fa-chart-bar"></i> Analytics Avancées</div>
                </div>
                
                <div class="tabs mb-4">
                    <button class="tab active" onclick="showAnalyticsTab('performance')">Performance</button>
                    <button class="tab" onclick="showAnalyticsTab('risk')">Risque</button>
                    <button class="tab" onclick="showAnalyticsTab('behavioral')">Comportement</button>
                    <button class="tab" onclick="showAnalyticsTab('temporal')">Temporel</button>
                </div>

                <!-- Performance Analytics -->
                <div id="analytics-performance" class="analytics-tab">
                    <div class="grid grid-4 gap-4 mb-4">
                        <div class="stat-box">
                            <div class="stat-value" id="analyticsExpectancy">€0.00</div>
                            <div class="stat-label">Expectancy</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="analyticsSortino">0.00</div>
                            <div class="stat-label">Sortino Ratio</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="analyticsCalmar">0.00</div>
                            <div class="stat-label">Calmar Ratio</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="analyticsVar">€0.00</div>
                            <div class="stat-label">VaR (95%)</div>
                        </div>
                    </div>

                    <div class="grid grid-2 gap-4 mb-4">
                        <div class="card">
                            <div class="card-title mb-4">Performance par Symbole</div>
                            <div class="chart-container-lg">
                                <canvas id="symbolPerformanceChart"></canvas>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-title mb-4">Performance Mensuelle</div>
                            <div class="chart-container-lg">
                                <canvas id="monthlyPerformanceChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Risk Analytics -->
                <div id="analytics-risk" class="analytics-tab" style="display: none;">
                    <div class="grid grid-3 gap-4 mb-4">
                        <div class="stat-box">
                            <div class="stat-value" id="riskVolatility">0%</div>
                            <div class="stat-label">Volatilité</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="riskMaxLoss">€0.00</div>
                            <div class="stat-label">Pire Trade</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="riskRecovery">0 jours</div>
                            <div class="stat-label">Temps Recup.</div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-title mb-4">Analyse de Risque</div>
                        <div class="chart-container-lg">
                            <canvas id="riskAnalysisChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Behavioral Analytics -->
                <div id="analytics-behavioral" class="analytics-tab" style="display: none;">
                    <div class="grid grid-3 gap-4 mb-4">
                        <div class="stat-box">
                            <div class="stat-value" id="behaviorWinRateLong">0%</div>
                            <div class="stat-label">Win Rate Long</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="behaviorWinRateShort">0%</div>
                            <div class="stat-label">Win Rate Short</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="behaviorBestStrategy">-</div>
                            <div class="stat-label">Meilleure Strat.</div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-title mb-4">Heatmap des Trades</div>
                        <div class="chart-container-xl">
                            <canvas id="tradesHeatmapChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Temporal Analytics -->
                <div id="analytics-temporal" class="analytics-tab" style="display: none;">
                    <div class="grid grid-4 gap-4 mb-4">
                        <div class="stat-box">
                            <div class="stat-value" id="temporalBestDay">-</div>
                            <div class="stat-label">Meilleur Jour</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="temporalBestHour">-</div>
                            <div class="stat-label">Meilleure Heure</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="temporalAvgDuration">-</div>
                            <div class="stat-label">Durée Moyenne</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="temporalActiveHours">-</div>
                            <div class="stat-label">Heures Actives</div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-title mb-4">Analyse Temporelle</div>
                        <div class="heatmap-container">
                            <div class="heatmap-grid" id="detailedHeatmap"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Portfolio Page -->
        <section id="page-portfolio" class="page">
            <div class="card mb-4">
                <div class="card-header">
                    <div class="card-title"><i class="fas fa-pie-chart"></i> Portefeuille</div>
                </div>
                
                <div class="grid grid-3 gap-4 mb-4">
                    <div class="stat-box highlight">
                        <div class="stat-value sensitive" id="portfolioValue">€0.00</div>
                        <div class="stat-label">Valeur Totale</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="portfolioDailyChange">+0.00%</div>
                        <div class="stat-label">Variation 24h</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="portfolioAllocations">0</div>
                        <div class="stat-label">Allocations</div>
                    </div>
                </div>

                <div class="grid grid-2 gap-4 mb-4">
                    <div class="card">
                        <div class="card-title mb-4">Allocation d'Actifs</div>
                        <div class="chart-container-lg">
                            <canvas id="portfolioAllocationChart"></canvas>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-title mb-4">Performance par Classe</div>
                        <div class="chart-container-lg">
                            <canvas id="assetClassChart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Positions Ouvertes</div>
                    </div>
                    <div class="trade-list" id="openPositionsList"></div>
                </div>
            </div>
        </section>

        <!-- Calculator Page -->
        <section id="page-calculator" class="page">
            <div class="card mb-4">
                <div class="card-header">
                    <div class="card-title"><i class="fas fa-calculator"></i> Calculateur Avancé</div>
                </div>

                <div class="grid grid-2 gap-4 mb-4">
                    <div class="card">
                        <div class="card-title mb-4">Calculateur de Position</div>
                        
                        <div class="form-group">
                            <label class="form-label">Capital (€)</label>
                            <input type="number" class="input" id="calcCapital" value="10000" step="100">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Risque par Trade (%)</label>
                            <input type="number" class="input" id="calcRiskPercent" value="2" step="0.1" min="0.1" max="50">
                        </div>
                        
                        <div class="grid grid-2 gap-3">
                            <div class="form-group">
                                <label class="form-label">Prix d'Entrée</label>
                                <input type="number" class="input" id="calcEntryPrice" step="0.0001">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Stop Loss</label>
                                <input type="number" class="input" id="calcStopLoss" step="0.0001">
                            </div>
                        </div>
                        
                        <div class="grid grid-2 gap-3">
                            <div class="form-group">
                                <label class="form-label">Take Profit</label>
                                <input type="number" class="input" id="calcTakeProfit" step="0.0001">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Frais (%)</label>
                                <input type="number" class="input" id="calcFees" value="0.1" step="0.01">
                            </div>
                        </div>
                        
                        <div class="grid grid-2 gap-3 mt-4">
                            <button class="btn btn-outline" onclick="calculateTargetPrice()">
                                <i class="fas fa-bullseye"></i> Cible R/R
                            </button>
                            <button class="btn btn-primary" onclick="calculatePosition()">
                                <i class="fas fa-calculator"></i> Calculer
                            </button>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-title mb-4">Résultats</div>
                        
                        <div id="calcResults" style="display: none;">
                            <div class="stats-grid stats-grid-3 mb-4">
                                <div class="stat-box">
                                    <div class="stat-value" id="calcPositionSize">0</div>
                                    <div class="stat-label">Quantité</div>
                                </div>
                                <div class="stat-box">
                                    <div class="stat-value" id="calcRiskAmount">€0</div>
                                    <div class="stat-label">Risque €</div>
                                </div>
                                <div class="stat-box">
                                    <div class="stat-value" id="calcRR">0.00</div>
                                    <div class="stat-label">Ratio R/R</div>
                                </div>
                                <div class="stat-box">
                                    <div class="stat-value" id="calcPositionValue">€0</div>
                                    <div class="stat-label">Valeur Pos.</div>
                                </div>
                                <div class="stat-box">
                                    <div class="stat-value" id="calcProfitPotential">€0</div>
                                    <div class="stat-label">Gain Potentiel</div>
                                </div>
                                <div class="stat-box">
                                    <div class="stat-value" id="calcRiskPercentResult">0%</div>
                                    <div class="stat-label">Risque/Capital</div>
                                </div>
                            </div>

                            <div class="ai-recommendation" id="calcRecommendation">
                                <div class="ai-recommendation-header">
                                    <i class="fas fa-robot ai-recommendation-icon"></i>
                                    <div class="ai-recommendation-title">Recommandation IA</div>
                                    <div class="ai-recommendation-confidence">Confiance: 95%</div>
                                </div>
                                <div class="ai-recommendation-content" id="calcRecommendationText">
                                    Calcul en cours...
                                </div>
                            </div>
                        </div>

                        <div id="calcEmpty" class="text-center py-8">
                            <i class="fas fa-calculator text-4xl text-muted mb-4"></i>
                            <div class="text-muted">Remplissez les champs et cliquez sur Calculer</div>
                        </div>
                    </div>
                </div>

                <!-- Quick Calculator -->
                <div class="card">
                    <div class="card-title mb-4">Calculateur Rapide</div>
                    <div class="grid grid-3 gap-3">
                        <div class="form-group">
                            <input type="number" class="input" placeholder="Prix Entrée" id="quickEntryPrice">
                        </div>
                        <div class="form-group">
                            <input type="number" class="input" placeholder="Stop Loss" id="quickStopLoss">
                        </div>
                        <div class="form-group">
                            <button class="btn btn-primary btn-block" onclick="quickPositionCalc()">
                                <i class="fas fa-bolt"></i> Calculer
                            </button>
                        </div>
                    </div>
                    <div id="quickCalcResult" class="mt-4" style="display: none;"></div>
                </div>
            </div>
        </section>

        <!-- Tools Page -->
        <section id="page-tools" class="page">
            <div class="grid grid-2 gap-4 mb-4">
                <div class="card">
                    <div class="card-title mb-4"><i class="fas fa-ruler"></i> Calculateur de Profit</div>
                    <div class="form-group">
                        <label class="form-label">Entrée</label>
                        <input type="number" class="input" id="profitEntry" step="0.0001">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Sortie</label>
                        <input type="number" class="input" id="profitExit" step="0.0001">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Quantité</label>
                        <input type="number" class="input" id="profitQuantity" step="0.001">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Side</label>
                        <select class="input" id="profitSide">
                            <option value="long">Long</option>
                            <option value="short">Short</option>
                        </select>
                    </div>
                    <button class="btn btn-primary btn-block" onclick="calculateProfit()">
                        Calculer Profit
                    </button>
                    <div id="profitResult" class="mt-4" style="display: none;"></div>
                </div>

                <div class="card">
                    <div class="card-title mb-4"><i class="fas fa-balance-scale"></i> Risk/Reward Simulator</div>
                    <div class="form-group">
                        <label class="form-label">Win Rate (%)</label>
                        <input type="number" class="input" id="rrWinRate" value="50" min="0" max="100">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Ratio R/R</label>
                        <input type="number" class="input" id="rrRatio" value="2" step="0.1">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Nombre de Trades</label>
                        <input type="number" class="input" id="rrNumTrades" value="100">
                    </div>
                    <button class="btn btn-primary btn-block" onclick="simulateRR()">
                        Simuler
                    </button>
                    <div id="rrResult" class="mt-4" style="display: none;"></div>
                </div>
            </div>

            <div class="card">
                <div class="card-title mb-4"><i class="fas fa-chart-area"></i> Market Analysis Tools</div>
                <div class="grid grid-3 gap-4">
                    <button class="btn btn-outline" onclick="openMarketScanner()">
                        <i class="fas fa-search"></i> Market Scanner
                    </button>
                    <button class="btn btn-outline" onclick="openCorrelationMatrix()">
                        <i class="fas fa-project-diagram"></i> Corrélations
                    </button>
                    <button class="btn btn-outline" onclick="openVolatilityAnalyzer()">
                        <i class="fas fa-wave-square"></i> Volatilité
                    </button>
                </div>
            </div>
        </section>

        <!-- Settings Page -->
        <section id="page-settings" class="page">
            <div class="grid grid-2 gap-4 mb-4">
                <div class="card">
                    <div class="card-title mb-4"><i class="fas fa-user-cog"></i> Paramètres Trading</div>
                    
                    <div class="form-group">
                        <label class="form-label">Capital Initial (€)</label>
                        <input type="number" class="input" id="settingsCapital" value="10000">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Devise</label>
                        <select class="input" id="settingsCurrency">
                            <option value="EUR">EUR (€)</option>
                            <option value="USD">USD ($)</option>
                            <option value="GBP">GBP (£)</option>
                            <option value="CHF">CHF (CHF)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Risque par Trade (%)</label>
                        <input type="number" class="input" id="settingsRiskPerTrade" value="2" step="0.1" min="0.1" max="50">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Taux Sans Risque (%)</label>
                        <input type="number" class="input" id="settingsRiskFreeRate" value="2" step="0.1">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Frais Moyens (%)</label>
                        <input type="number" class="input" id="settingsFees" value="0.06" step="0.01">
                    </div>
                    
                    <button class="btn btn-primary btn-block" onclick="saveSettings()">
                        Sauvegarder les Paramètres
                    </button>
                </div>

                <div class="card">
                    <div class="card-title mb-4"><i class="fas fa-palette"></i> Personnalisation</div>
                    
                    <div class="form-group">
                        <label class="form-label">Thème</label>
                        <div class="grid grid-2 gap-2">
                            <button class="btn btn-outline" onclick="setTheme('light')">
                                <i class="fas fa-sun"></i> Clair
                            </button>
                            <button class="btn btn-outline" onclick="setTheme('dark')">
                                <i class="fas fa-moon"></i> Sombre
                            </button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Couleur d'Accent</label>
                        <div class="grid grid-3 gap-2">
                            <button class="btn btn-sm" style="background:#00AB55" onclick="setAccentColor('default')"></button>
                            <button class="btn btn-sm" style="background:#1890FF" onclick="setAccentColor('blue')"></button>
                            <button class="btn btn-sm" style="background:#7635DC" onclick="setAccentColor('purple')"></button>
                            <button class="btn btn-sm" style="background:#FD7E14" onclick="setAccentColor('orange')"></button>
                            <button class="btn btn-sm" style="background:#FF4842" onclick="setAccentColor('red')"></button>
                            <button class="btn btn-sm" style="background:#E64980" onclick="setAccentColor('pink')"></button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="checkbox-container">
                            <input type="checkbox" id="settingsGhostMode">
                            <span class="checkbox-custom"></span>
                            <span>Mode Discret</span>
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <label class="checkbox-container">
                            <input type="checkbox" id="settingsNotifications">
                            <span class="checkbox-custom"></span>
                            <span>Notifications</span>
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <label class="checkbox-container">
                            <input type="checkbox" id="settingsAutoBackup">
                            <span class="checkbox-custom"></span>
                            <span>Sauvegarde Automatique</span>
                        </label>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-title mb-4"><i class="fas fa-database"></i> Gestion des Données</div>
                
                <div class="grid grid-3 gap-3 mb-4">
                    <button class="btn btn-outline" onclick="exportAllData()">
                        <i class="fas fa-download"></i> Exporter Tout
                    </button>
                    <button class="btn btn-outline" onclick="importData()">
                        <i class="fas fa-upload"></i> Importer
                    </button>
                    <button class="btn btn-outline" onclick="backupToCloud()">
                        <i class="fas fa-cloud"></i> Sauvegarde Cloud
                    </button>
                </div>
                
                <div class="grid grid-3 gap-3">
                    <button class="btn btn-outline" onclick="clearCache()">
                        <i class="fas fa-trash"></i> Vider Cache
                    </button>
                    <button class="btn btn-outline" onclick="resetSettings()">
                        <i class="fas fa-undo"></i> Réinitialiser
                    </button>
                    <button class="btn btn-danger" onclick="confirmDeleteAllData()">
                        <i class="fas fa-skull-crossbones"></i> Tout Supprimer
                    </button>
                </div>
                
                <div class="mt-4">
                    <button class="btn btn-ghost btn-block" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> Déconnexion
                    </button>
                </div>
            </div>

            <div class="card">
                <div class="card-title mb-4"><i class="fas fa-info-circle"></i> À Propos</div>
                <div class="text-sm text-muted mb-4">
                    <p><strong>TITAN Pro v2.0</strong> - Le journal de trading ultime</p>
                    <p>Développé avec ❤️ pour les traders sérieux</p>
                    <p class="mt-2">© 2024 TITAN Trading Systems. Tous droits réservés.</p>
                </div>
                <div class="flex items-center gap-2">
                    <a href="#" class="text-sm text-accent">Conditions d'utilisation</a>
                    <span class="text-muted">•</span>
                    <a href="#" class="text-sm text-accent">Politique de confidentialité</a>
                    <span class="text-muted">•</span>
                    <a href="#" class="text-sm text-accent">Support</a>
                </div>
            </div>
        </section>
    </div>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <button class="nav-item active" onclick="showPage('page-dashboard')">
            <i class="fas fa-th-large"></i>
            <span>Dashboard</span>
        </button>
        <button class="nav-item" onclick="showPage('page-trades')">
            <i class="fas fa-list-ul"></i>
            <span>Journal</span>
            <span class="nav-badge" id="navBadgeTrades">0</span>
        </button>
        <button class="nav-item" onclick="showPage('page-analytics')">
            <i class="fas fa-chart-bar"></i>
            <span>Analytics</span>
        </button>
        <button class="nav-item" onclick="showPage('page-portfolio')">
            <i class="fas fa-pie-chart"></i>
            <span>Portfolio</span>
        </button>
        <button class="nav-item" onclick="showPage('page-calculator')">
            <i class="fas fa-calculator"></i>
            <span>Calculs</span>
        </button>
        <button class="nav-item" onclick="showPage('page-tools')">
            <i class="fas fa-tools"></i>
            <span>Outils</span>
        </button>
        <button class="nav-item" onclick="showPage('page-settings')">
            <i class="fas fa-cog"></i>
            <span>Réglages</span>
        </button>
    </nav>

    <!-- FAB Container -->
    <div class="fab-container">
        <div class="fab-menu" id="fabMenu">
            <button class="fab fab-secondary" onclick="quickAddTrade()" title="Ajout rapide">
                <i class="fas fa-plus"></i>
            </button>
            <button class="fab fab-secondary" onclick="quickCalculator()" title="Calculateur rapide">
                <i class="fas fa-calculator"></i>
            </button>
            <button class="fab fab-secondary" onclick="exportQuickStats()" title="Exporter stats">
                <i class="fas fa-file-export"></i>
            </button>
        </div>
        <button class="fab fab-primary" onclick="toggleFabMenu()" id="mainFab">
            <i class="fas fa-plus" id="fabIcon"></i>
        </button>
    </div>

    <!-- Trade Modal -->
    <div class="modal-backdrop" id="tradeModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title" id="tradeModalTitle">Nouveau Trade</div>
                <button class="icon-btn" onclick="closeModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="template-buttons mb-4">
                    <button class="template-btn" onclick="applyTradeTemplate('swing')">Swing</button>
                    <button class="template-btn" onclick="applyTradeTemplate('day')">Day Trading</button>
                    <button class="template-btn" onclick="applyTradeTemplate('scalp')">Scalping</button>
                    <button class="template-btn" onclick="fillFromCalculator()">Remplir via Calcul</button>
                </div>

                <form id="tradeForm" onsubmit="saveTrade(event)">
                    <input type="hidden" id="tradeId">
                    
                    <!-- Emotion Selector -->
                    <div class="emotion-selector">
                        <label>
                            <input type="radio" name="emotion" value="greedy" class="emotion-radio">
                            <span class="emotion-label" data-tooltip="Avide">🤑</span>
                        </label>
                        <label>
                            <input type="radio" name="emotion" value="happy" class="emotion-radio">
                            <span class="emotion-label" data-tooltip="Heureux">😎</span>
                        </label>
                        <label>
                            <input type="radio" name="emotion" value="neutral" class="emotion-radio" checked>
                            <span class="emotion-label" data-tooltip="Neutre">😐</span>
                        </label>
                        <label>
                            <input type="radio" name="emotion" value="fear" class="emotion-radio">
                            <span class="emotion-label" data-tooltip="Peur">😰</span>
                        </label>
                        <label>
                            <input type="radio" name="emotion" value="angry" class="emotion-radio">
                            <span class="emotion-label" data-tooltip="En colère">😡</span>
                        </label>
                    </div>

                    <!-- Basic Info -->
                    <div class="grid grid-2 gap-3 mb-3">
                        <div class="form-group">
                            <label class="form-label">Symbole</label>
                            <input type="text" id="tradeSymbol" class="input" placeholder="BTC/USD" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Type</label>
                            <select id="tradeSide" class="input">
                                <option value="long">Long</option>
                                <option value="short">Short</option>
                            </select>
                        </div>
                    </div>

                    <!-- Dates -->
                    <div class="grid grid-2 gap-3 mb-3">
                        <div class="form-group">
                            <label class="form-label">Date Entrée</label>
                            <input type="datetime-local" id="tradeEntryDate" class="input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Date Sortie</label>
                            <input type="datetime-local" id="tradeExitDate" class="input">
                        </div>
                    </div>

                    <!-- Prices -->
                    <div class="card mb-3">
                        <div class="card-title mb-3">Prix & Quantité</div>
                        <div class="grid grid-2 gap-3 mb-3">
                            <div class="form-group">
                                <label class="form-label">Prix Entrée</label>
                                <input type="number" step="0.0001" id="tradeEntryPrice" class="input" required oninput="calculateLiveRR()">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Prix Sortie</label>
                                <input type="number" step="0.0001" id="tradeExitPrice" class="input" oninput="calculateLiveRR()">
                            </div>
                        </div>
                        <div class="grid grid-2 gap-3 mb-3">
                            <div class="form-group">
                                <label class="form-label">Stop Loss</label>
                                <input type="number" step="0.0001" id="tradeStopLoss" class="input" oninput="calculateLiveRR()">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Take Profit</label>
                                <input type="number" step="0.0001" id="tradeTakeProfit" class="input" oninput="calculateLiveRR()">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Quantité</label>
                            <input type="number" step="0.001" id="tradeQuantity" class="input" required oninput="calculateLiveRR()">
                        </div>
                        
                        <!-- Live Calculations -->
                        <div class="grid grid-3 gap-3 mt-3 pt-3 border-top">
                            <div>
                                <div class="text-sm text-muted">Risque/Récompense</div>
                                <div class="font-bold" id="liveRR">0.00</div>
                            </div>
                            <div>
                                <div class="text-sm text-muted">Risque €</div>
                                <div class="font-bold text-danger" id="liveRisk">€0.00</div>
                            </div>
                            <div>
                                <div class="text-sm text-muted">Position Value</div>
                                <div class="font-bold" id="livePositionValue">€0.00</div>
                            </div>
                        </div>
                    </div>

                    <!-- Strategy & Tags -->
                    <div class="form-group mb-3">
                        <label class="form-label">Stratégie</label>
                        <input type="text" id="tradeStrategy" class="input" placeholder="Breakout, Pullback, etc.">
                    </div>

                    <div class="form-group mb-3">
                        <label class="form-label">Tags</label>
                        <div class="tags-container" id="tradeTags">
                            <span class="tag-pill" onclick="toggleTag(this)">#Trend</span>
                            <span class="tag-pill" onclick="toggleTag(this)">#Reversal</span>
                            <span class="tag-pill" onclick="toggleTag(this)">#Breakout</span>
                            <span class="tag-pill" onclick="toggleTag(this)">#FOMO</span>
                            <span class="tag-pill" onclick="toggleTag(this)">#News</span>
                            <span class="tag-pill" onclick="toggleTag(this)">#Impulse</span>
                            <span class="tag-pill" onclick="toggleTag(this)">#Plan</span>
                            <span class="tag-pill" onclick="toggleTag(this)">#Emotion</span>
                        </div>
                    </div>

                    <!-- Notes -->
                    <div class="form-group mb-4">
                        <label class="form-label">Notes & Analyse</label>
                        <textarea id="tradeNotes" class="input textarea" rows="3" placeholder="Raison d'entrée, émotions, contexte marché..."></textarea>
                    </div>

                    <!-- Actions -->
                    <div class="grid grid-2 gap-3">
                        <button type="button" class="btn btn-outline" onclick="toggleFavorite()" id="favoriteBtn">
                            <i class="far fa-star"></i> Favori
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Sauvegarder
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div class="modal-backdrop" id="confirmationModal">
        <div class="modal modal-sm">
            <div class="modal-header">
                <div class="modal-title" id="confirmationTitle">Confirmation</div>
            </div>
            <div class="modal-body">
                <p id="confirmationMessage">Êtes-vous sûr de vouloir effectuer cette action ?</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeConfirmation()">Annuler</button>
                <button class="btn btn-danger" id="confirmationConfirm">Confirmer</button>
            </div>
        </div>
    </div>

    <!-- Import Modal -->
    <div class="modal-backdrop" id="importModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">Importer des Données</div>
                <button class="icon-btn" onclick="closeImportModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Format</label>
                    <select class="input" id="importFormat">
                        <option value="json">JSON (TITAN Backup)</option>
                        <option value="csv">CSV (Excel/Sheets)</option>
                        <option value="broker">Broker Export</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Fichier</label>
                    <input type="file" id="importFile" class="input" accept=".json,.csv,.txt">
                </div>
                
                <div class="form-group">
                    <label class="checkbox-container">
                        <input type="checkbox" id="importOverwrite" checked>
                        <span class="checkbox-custom"></span>
                        <span>Remplacer les données existantes</span>
                    </label>
                </div>
                
                <div class="form-group">
                    <label class="checkbox-container">
                        <input type="checkbox" id="importBackup" checked>
                        <span class="checkbox-custom"></span>
                        <span>Créer une sauvegarde avant l'import</span>
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeImportModal()">Annuler</button>
                <button class="btn btn-primary" onclick="processImport()">Importer</button>
            </div>
        </div>
    </div>

    <!-- Market Scanner Modal -->
    <div class="modal-backdrop" id="marketScannerModal">
        <div class="modal modal-lg">
            <div class="modal-header">
                <div class="modal-title">Market Scanner</div>
                <button class="icon-btn" onclick="closeMarketScanner()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div id="marketScannerContent">
                    <!-- Market scanner content will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Onboarding Tour -->
    <div class="onboarding-tour" id="onboardingTour">
        <div class="tour-step">
            <div class="tour-content">
                <h3 class="card-title mb-3">Bienvenue sur TITAN Pro ! 🚀</h3>
                <p>Découvrez le journal de trading le plus avancé jamais créé. Suivez ce rapide tour pour maîtriser toutes les fonctionnalités.</p>
            </div>
            <div class="tour-actions">
                <button class="btn btn-outline" onclick="skipOnboarding()">Passer</button>
                <button class="btn btn-primary" onclick="nextTourStep()">Commencer</button>
            </div>
        </div>
    </div>

    <!-- TradingView Widget Container -->
    <div id="tradingview-widget" style="display:none;"></div>

    <script>
        // ==========================================
        // CONFIGURATION & INITIALIZATION
        // ==========================================
        const firebaseConfig = {
            apiKey: "AIzaSyDBPftX2zuNdFuFVdGWwsannEOA1w11_YI",
            authDomain: "journaltrading-62131.firebaseapp.com",
            projectId: "journaltrading-62131",
            storageBucket: "journaltrading-62131.firebasestorage.app",
            messagingSenderId: "111372023588",
            appId: "1:111372023588:web:f76f09d140109a9e5fa5b1"
        };

        // Initialize Firebase
        try {
            firebase.initializeApp(firebaseConfig);
        } catch (e) {
            console.log("Firebase already initialized");
        }

        // Global State Management
        const TITAN = {
            // User & Auth
            user: null,
            isGuest: false,
            
            // Data
            trades: [],
            settings: {
                currency: 'EUR',
                capital: 10000,
                theme: 'light',
                accent: 'default',
                fees: 0.06,
                riskPerTrade: 2,
                riskFreeRate: 2,
                ghostMode: false,
                notifications: true,
                autoBackup: true
            },
            
            // UI State
            currentPage: 'dashboard',
            currentTradeTab: 'all',
            editingTrade: null,
            isFavorite: false,
            notifications: [],
            chartInstances: {},
            
            // Cache & Performance
            calculationCache: new Map(),
            updateQueue: [],
            isUpdating: false,
            
            // Trading Data
            marketData: {},
            portfolio: {},
            analytics: {},
            
            // Initialization flag
            initialized: false
        };

        // ==========================================
        // AUTHENTICATION SYSTEM
        // ==========================================
        function initAuth() {
            firebase.auth().onAuthStateChanged(user => {
                if (user) {
                    TITAN.user = user;
                    TITAN.isGuest = false;
                    loadUserData();
                    showApp();
                    showToast(`Bon retour, ${user.email.split('@')[0]} !`, 'success');
                } else {
                    // Show login screen
                    document.getElementById('loginScreen').style.display = 'flex';
                    document.getElementById('appContainer').style.display = 'none';
                }
            });
        }

        function authAction(action) {
            const email = document.getElementById('authEmail').value.trim();
            const password = document.getElementById('authPassword').value;
            
            if (!email || !password) {
                showToast('Veuillez remplir tous les champs', 'error');
                return;
            }
            
            const auth = firebase.auth();
            let promise;
            
            if (action === 'login') {
                promise = auth.signInWithEmailAndPassword(email, password);
            } else {
                const confirmPassword = document.getElementById('authConfirmPassword').value;
                if (password !== confirmPassword) {
                    showToast('Les mots de passe ne correspondent pas', 'error');
                    return;
                }
                promise = auth.createUserWithEmailAndPassword(email, password);
            }
            
            promise
                .then(userCredential => {
                    // Handled by onAuthStateChanged
                })
                .catch(error => {
                    showToast(error.message, 'error');
                });
        }

        function enterGuestMode() {
            TITAN.user = { uid: 'guest_' + Date.now(), email: 'guest@titan.com' };
            TITAN.isGuest = true;
            loadLocalData();
            showApp();
            showToast('Mode invité activé', 'info');
        }

        function logout() {
            if (!TITAN.isGuest) {
                firebase.auth().signOut();
            }
            location.reload();
        }

        // ==========================================
        // DATA MANAGEMENT
        // ==========================================
        async function loadUserData() {
            if (TITAN.isGuest) {
                loadLocalData();
                return;
            }
            
            try {
                const userRef = firebase.firestore().collection('users').doc(TITAN.user.uid);
                const doc = await userRef.get();
                
                if (doc.exists) {
                    const data = doc.data();
                    TITAN.trades = data.trades || [];
                    TITAN.settings = { ...TITAN.settings, ...data.settings };
                    TITAN.notifications = data.notifications || [];
                    
                    // Save to local storage for offline access
                    saveLocalData();
                }
                
                updateUI();
            } catch (error) {
                console.error('Error loading user data:', error);
                loadLocalData();
            }
        }

        function loadLocalData() {
            try {
                const data = localStorage.getItem('titan_pro_data');
                if (data) {
                    const parsed = JSON.parse(data);
                    TITAN.trades = parsed.trades || [];
                    TITAN.settings = { ...TITAN.settings, ...parsed.settings };
                    TITAN.notifications = parsed.notifications || [];
                }
            } catch (error) {
                console.error('Error loading local data:', error);
            }
            
            updateUI();
        }

        async function saveUserData() {
            // Save to local storage
            saveLocalData();
            
            // Save to Firebase if logged in
            if (!TITAN.isGuest && TITAN.user) {
                try {
                    const userRef = firebase.firestore().collection('users').doc(TITAN.user.uid);
                    await userRef.set({
                        trades: TITAN.trades,
                        settings: TITAN.settings,
                        notifications: TITAN.notifications,
                        lastUpdated: new Date().toISOString()
                    }, { merge: true });
                } catch (error) {
                    console.error('Error saving to Firebase:', error);
                }
            }
        }

        function saveLocalData() {
            try {
                const data = JSON.stringify({
                    trades: TITAN.trades,
                    settings: TITAN.settings,
                    notifications: TITAN.notifications,
                    lastUpdated: new Date().toISOString()
                });
                localStorage.setItem('titan_pro_data', data);
            } catch (error) {
                console.error('Error saving local data:', error);
            }
        }

        // ==========================================
        // ADVANCED CALCULATION ENGINE
        // ==========================================
        class PositionCalculator {
            static calculatePositionSize(capital, riskPercent, entryPrice, stopLoss) {
                if (!entryPrice || !stopLoss) return 0;
                const riskAmount = capital * (riskPercent / 100);
                const priceRisk = Math.abs(entryPrice - stopLoss);
                return riskAmount / priceRisk;
            }
            
            static calculateRiskAmount(positionSize, entryPrice, stopLoss) {
                return Math.abs(entryPrice - stopLoss) * positionSize;
            }
            
            static calculateRRRatio(entryPrice, stopLoss, takeProfit) {
                const risk = Math.abs(entryPrice - stopLoss);
                const reward = Math.abs(takeProfit - entryPrice);
                return risk > 0 ? reward / risk : 0;
            }
            
            static calculatePnl(entryPrice, exitPrice, quantity, side, fees = 0.06) {
                let pnl;
                if (side === 'long') {
                    pnl = (exitPrice - entryPrice) * quantity;
                } else {
                    pnl = (entryPrice - exitPrice) * quantity;
                }
                
                const totalFees = (entryPrice * quantity + exitPrice * quantity) * (fees / 100);
                return pnl - totalFees;
            }
        }

        class RiskMetrics {
            static calculateMaxDrawdown(equityCurve) {
                let peak = equityCurve[0];
                let maxDrawdown = 0;
                
                for (const value of equityCurve) {
                    if (value > peak) peak = value;
                    const drawdown = (peak - value) / peak;
                    if (drawdown > maxDrawdown) maxDrawdown = drawdown;
                }
                
                return maxDrawdown * 100;
            }
            
            static calculateSharpeRatio(returns, riskFreeRate = 2) {
                if (returns.length === 0) return 0;
                
                const avgReturn = returns.reduce((a, b) => a + b, 0) / returns.length;
                const variance = returns.reduce((acc, ret) => acc + Math.pow(ret - avgReturn, 2), 0) / returns.length;
                const stdDev = Math.sqrt(variance);
                
                if (stdDev === 0) return 0;
                return (avgReturn - riskFreeRate / 100) / stdDev * Math.sqrt(252);
            }
            
            static calculateSortinoRatio(returns, riskFreeRate = 2) {
                if (returns.length === 0) return 0;
                
                const avgReturn = returns.reduce((a, b) => a + b, 0) / returns.length;
                const negativeReturns = returns.filter(r => r < 0);
                const downsideStdDev = Math.sqrt(
                    negativeReturns.reduce((acc, ret) => acc + Math.pow(ret, 2), 0) / returns.length
                );
                
                if (downsideStdDev === 0) return 0;
                return (avgReturn - riskFreeRate / 100) / downsideStdDev * Math.sqrt(252);
            }
            
            static calculateVaR(returns, confidence = 0.95) {
                if (returns.length === 0) return 0;
                
                const sorted = [...returns].sort((a, b) => a - b);
                const index = Math.floor((1 - confidence) * sorted.length);
                return Math.abs(sorted[index]) * 100;
            }
        }

        class PerformanceAnalytics {
            static analyzeTrades(trades) {
                const closedTrades = trades.filter(t => t.exitPrice);
                const winningTrades = closedTrades.filter(t => t.pnl > 0);
                const losingTrades = closedTrades.filter(t => t.pnl <= 0);
                
                return {
                    total: trades.length,
                    closed: closedTrades.length,
                    open: trades.length - closedTrades.length,
                    winning: winningTrades.length,
                    losing: losingTrades.length,
                    winRate: closedTrades.length > 0 ? (winningTrades.length / closedTrades.length) * 100 : 0,
                    totalPnl: closedTrades.reduce((sum, t) => sum + (t.pnl || 0), 0),
                    avgWin: winningTrades.length > 0 ? winningTrades.reduce((sum, t) => sum + t.pnl, 0) / winningTrades.length : 0,
                    avgLoss: losingTrades.length > 0 ? Math.abs(losingTrades.reduce((sum, t) => sum + t.pnl, 0)) / losingTrades.length : 0,
                    largestWin: winningTrades.length > 0 ? Math.max(...winningTrades.map(t => t.pnl)) : 0,
                    largestLoss: losingTrades.length > 0 ? Math.min(...losingTrades.map(t => t.pnl)) : 0,
                    profitFactor: losingTrades.reduce((sum, t) => sum + Math.abs(t.pnl), 0) > 0 ?
                        winningTrades.reduce((sum, t) => sum + t.pnl, 0) / losingTrades.reduce((sum, t) => sum + Math.abs(t.pnl), 0) : 0
                };
            }
            
            static calculateExpectancy(trades) {
                const analysis = this.analyzeTrades(trades);
                return (analysis.winRate / 100 * analysis.avgWin) - ((100 - analysis.winRate) / 100 * analysis.avgLoss);
            }
            
            static calculateEquityCurve(trades, initialCapital) {
                const closedTrades = trades.filter(t => t.exitPrice)
                    .sort((a, b) => new Date(a.exitDate || a.entryDate) - new Date(b.exitDate || b.entryDate));
                
                let equity = initialCapital;
                const curve = [equity];
                const dates = [new Date(Date.now() - 30 * 24 * 60 * 60 * 1000)]; // 30 days ago
                
                closedTrades.forEach(trade => {
                    equity += trade.pnl || 0;
                    curve.push(equity);
                    dates.push(new Date(trade.exitDate || trade.entryDate));
                });
                
                return { curve, dates };
            }
        }

        class BehavioralAnalytics {
            static analyzeEmotions(trades) {
                const emotionStats = {};
                trades.forEach(trade => {
                    const emotion = trade.emotion || 'neutral';
                    emotionStats[emotion] = emotionStats[emotion] || { count: 0, totalPnl: 0 };
                    emotionStats[emotion].count++;
                    emotionStats[emotion].totalPnl += trade.pnl || 0;
                });
                
                return emotionStats;
            }
            
            static analyzeTemporalPatterns(trades) {
                const hourStats = Array(24).fill().map(() => ({ count: 0, pnl: 0 }));
                const dayStats = Array(7).fill().map(() => ({ count: 0, pnl: 0 }));
                
                trades.forEach(trade => {
                    const date = new Date(trade.entryDate);
                    const hour = date.getHours();
                    const day = date.getDay();
                    
                    hourStats[hour].count++;
                    hourStats[hour].pnl += trade.pnl || 0;
                    
                    dayStats[day].count++;
                    dayStats[day].pnl += trade.pnl || 0;
                });
                
                return { hourStats, dayStats };
            }
            
            static analyzeStrategyPerformance(trades) {
                const strategyStats = {};
                trades.forEach(trade => {
                    const strategy = trade.strategy || 'No Strategy';
                    strategyStats[strategy] = strategyStats[strategy] || { count: 0, pnl: 0, wins: 0 };
                    strategyStats[strategy].count++;
                    strategyStats[strategy].pnl += trade.pnl || 0;
                    if (trade.pnl > 0) strategyStats[strategy].wins++;
                });
                
                return strategyStats;
            }
        }

        // ==========================================
        // UI MANAGEMENT
        // ==========================================
        function showApp() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('appContainer').style.display = 'block';
            applyThemeSettings();
            updateUI();
            startAutoUpdates();
        }

        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Deactivate all nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Show selected page
            document.getElementById(pageId).classList.add('active');
            TITAN.currentPage = pageId;
            
            // Activate corresponding nav item
            const navMap = {
                'page-dashboard': 0,
                'page-trades': 1,
                'page-analytics': 2,
                'page-portfolio': 3,
                'page-calculator': 4,
                'page-tools': 5,
                'page-settings': 6
            };
            
            const navIndex = navMap[pageId];
            if (navIndex !== undefined) {
                document.querySelectorAll('.nav-item')[navIndex].classList.add('active');
            }
            
            // Update page-specific content
            switch(pageId) {
                case 'page-dashboard':
                    updateDashboard();
                    break;
                case 'page-trades':
                    updateTradeList();
                    break;
                case 'page-analytics':
                    updateAnalytics();
                    break;
                case 'page-portfolio':
                    updatePortfolio();
                    break;
                case 'page-calculator':
                    initCalculator();
                    break;
            }
        }

        function updateUI() {
            if (TITAN.isUpdating) return;
            TITAN.isUpdating = true;
            
            // Update all components
            updateDashboardStats();
            updateTradeCounts();
            updateNotificationBadge();
            updateThemeUI();
            
            // Schedule next update
            setTimeout(() => {
                TITAN.isUpdating = false;
            }, 100);
        }

        // ==========================================
        // DASHBOARD FUNCTIONS
        // ==========================================
        function updateDashboard() {
            updateDashboardStats();
            renderCalendar();
            renderHeatmap();
            updateRecentTrades();
            updateCharts();
        }

        function updateDashboardStats() {
            const analysis = PerformanceAnalytics.analyzeTrades(TITAN.trades);
            const equityCurve = PerformanceAnalytics.calculateEquityCurve(TITAN.trades, TITAN.settings.capital);
            const returns = equityCurve.curve.slice(1).map((value, index) => 
                (value - equityCurve.curve[index]) / equityCurve.curve[index]
            );
            
            // Update welcome message
            const welcomeEl = document.getElementById('welcomeMessage');
            if (TITAN.user && TITAN.user.email) {
                const username = TITAN.user.email.split('@')[0];
                welcomeEl.textContent = `Bon retour, ${username}`;
            }
            
            // Update date
            document.getElementById('dashboardDate').textContent = new Date().toLocaleDateString('fr-FR', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            // Update capital
            const totalCapital = TITAN.settings.capital + analysis.totalPnl;
            document.getElementById('totalCapital').textContent = formatCurrency(totalCapital);
            
            // Update daily PnL
            const today = new Date().toDateString();
            const dailyPnl = TITAN.trades
                .filter(t => new Date(t.entryDate).toDateString() === today)
                .reduce((sum, t) => sum + (t.pnl || 0), 0);
            document.getElementById('dailyPnl').textContent = formatCurrency(dailyPnl, true);
            document.getElementById('dailyPnl').style.color = dailyPnl >= 0 ? 'var(--success)' : 'var(--danger)';
            
            // Update win streak
            const streak = calculateWinStreak();
            document.getElementById('winStreak').textContent = `${Math.abs(streak)} ${streak > 0 ? '🔥' : '❄️'}`;
            document.getElementById('winStreak').style.color = streak > 0 ? 'var(--success)' : 'var(--danger)';
            
            // Update stats
            document.getElementById('winRate').textContent = analysis.winRate.toFixed(1) + '%';
            document.getElementById('profitFactor').textContent = analysis.profitFactor.toFixed(2);
            document.getElementById('avgRR').textContent = calculateAverageRR().toFixed(2);
            document.getElementById('maxDrawdown').textContent = RiskMetrics.calculateMaxDrawdown(equityCurve.curve).toFixed(1) + '%';
            document.getElementById('sharpeRatio').textContent = RiskMetrics.calculateSharpeRatio(returns, TITAN.settings.riskFreeRate).toFixed(2);
            
            // Update analytics
            document.getElementById('analyticsExpectancy').textContent = formatCurrency(PerformanceAnalytics.calculateExpectancy(TITAN.trades));
            document.getElementById('analyticsSortino').textContent = RiskMetrics.calculateSortinoRatio(returns, TITAN.settings.riskFreeRate).toFixed(2);
            document.getElementById('analyticsCalmar').textContent = calculateCalmarRatio(equityCurve.curve).toFixed(2);
            document.getElementById('analyticsVar').textContent = formatCurrency(RiskMetrics.calculateVaR(returns) * TITAN.settings.capital / 100);
        }

        function calculateWinStreak() {
            const closedTrades = TITAN.trades
                .filter(t => t.exitPrice)
                .sort((a, b) => new Date(b.exitDate || b.entryDate) - new Date(a.exitDate || a.entryDate));
            
            if (closedTrades.length === 0) return 0;
            
            let streak = closedTrades[0].pnl > 0 ? 1 : -1;
            
            for (let i = 1; i < closedTrades.length; i++) {
                if ((closedTrades[i].pnl > 0 && streak > 0) || (closedTrades[i].pnl <= 0 && streak < 0)) {
                    streak += closedTrades[i].pnl > 0 ? 1 : -1;
                } else {
                    break;
                }
            }
            
            return streak;
        }

        function calculateAverageRR() {
            const tradesWithRR = TITAN.trades.filter(t => t.entryPrice && t.stopLoss && t.takeProfit);
            if (tradesWithRR.length === 0) return 0;
            
            const totalRR = tradesWithRR.reduce((sum, t) => {
                return sum + PositionCalculator.calculateRRRatio(t.entryPrice, t.stopLoss, t.takeProfit);
            }, 0);
            
            return totalRR / tradesWithRR.length;
        }

        function calculateCalmarRatio(equityCurve) {
            if (equityCurve.length < 2) return 0;
            
            const startValue = equityCurve[0];
            const endValue = equityCurve[equityCurve.length - 1];
            const periods = equityCurve.length / 252; // Approximate years
            
            if (startValue <= 0 || periods <= 0) return 0;
            
            const cagr = Math.pow(endValue / startValue, 1 / periods) - 1;
            const maxDrawdown = RiskMetrics.calculateMaxDrawdown(equityCurve) / 100;
            
            return maxDrawdown > 0 ? cagr / maxDrawdown : 0;
        }

        // ==========================================
        // TRADE MANAGEMENT
        // ==========================================
        function updateTradeList(filter = 'all') {
            TITAN.currentTradeTab = filter;
            
            // Update tab UI
            document.querySelectorAll('#page-trades .tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event?.currentTarget.classList.add('active');
            
            let filteredTrades = [...TITAN.trades];
            
            switch(filter) {
                case 'open':
                    filteredTrades = TITAN.trades.filter(t => !t.exitPrice);
                    break;
                case 'closed':
                    filteredTrades = TITAN.trades.filter(t => t.exitPrice);
                    break;
                case 'winning':
                    filteredTrades = TITAN.trades.filter(t => t.pnl > 0);
                    break;
                case 'losing':
                    filteredTrades = TITAN.trades.filter(t => t.pnl <= 0);
                    break;
                case 'favorite':
                    filteredTrades = TITAN.trades.filter(t => t.isFavorite);
                    break;
            }
            
            // Apply search filter
            const searchTerm = document.getElementById('searchTrades')?.value.toLowerCase();
            if (searchTerm) {
                filteredTrades = filteredTrades.filter(trade => 
                    trade.symbol.toLowerCase().includes(searchTerm) ||
                    trade.strategy?.toLowerCase().includes(searchTerm) ||
                    trade.notes?.toLowerCase().includes(searchTerm) ||
                    (trade.tags || []).some(tag => tag.toLowerCase().includes(searchTerm))
                );
            }
            
            // Sort by date (newest first)
            filteredTrades.sort((a, b) => new Date(b.entryDate) - new Date(a.entryDate));
            
            // Render trades
            const container = document.getElementById('tradeListContainer');
            if (filteredTrades.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-search"></i>
                        <div>Aucun trade trouvé</div>
                    </div>
                `;
            } else {
                container.innerHTML = filteredTrades.map(trade => createTradeElement(trade)).join('');
            }
        }

        function createTradeElement(trade) {
            const isClosed = trade.exitPrice;
            const pnl = trade.pnl || 0;
            const pnlClass = pnl > 0 ? 'positive' : pnl < 0 ? 'negative' : 'neutral';
            const sideClass = trade.side === 'long' ? 'long' : 'short';
            
            return `
                <div class="trade-item ${trade.isFavorite ? 'favorite' : ''}" onclick="editTrade('${trade.id}')">
                    <div class="trade-main">
                        <div class="trade-symbol">
                            <span class="side-indicator ${sideClass}">${trade.side === 'long' ? 'LONG' : 'SHORT'}</span>
                            ${trade.symbol}
                            ${trade.isFavorite ? '⭐' : ''}
                        </div>
                        <div class="trade-details">
                            ${trade.quantity} @ ${formatNumber(trade.entryPrice)}
                            ${isClosed ? ` → ${formatNumber(trade.exitPrice)}` : ''}
                        </div>
                        <div class="trade-meta">
                            ${new Date(trade.entryDate).toLocaleDateString('fr-FR')}
                            ${trade.strategy ? ` • ${trade.strategy}` : ''}
                            ${(trade.tags || []).map(tag => `<span class="badge badge-outline">${tag}</span>`).join('')}
                        </div>
                    </div>
                    <div class="trade-pnl ${pnlClass}">
                        ${isClosed ? formatCurrency(pnl, true) : 'EN COURS'}
                    </div>
                    <div class="trade-actions">
                        <button class="icon-btn" onclick="toggleTradeFavorite('${trade.id}', event)">
                            <i class="${trade.isFavorite ? 'fas' : 'far'} fa-star"></i>
                        </button>
                        <button class="icon-btn" onclick="deleteTrade('${trade.id}', event)">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `;
        }

        function updateTradeCounts() {
            const allCount = TITAN.trades.length;
            const openCount = TITAN.trades.filter(t => !t.exitPrice).length;
            const closedCount = TITAN.trades.filter(t => t.exitPrice).length;
            const winningCount = TITAN.trades.filter(t => t.pnl > 0).length;
            const losingCount = TITAN.trades.filter(t => t.pnl <= 0).length;
            const favoriteCount = TITAN.trades.filter(t => t.isFavorite).length;
            
            document.getElementById('allCount').textContent = allCount;
            document.getElementById('openCount').textContent = openCount;
            document.getElementById('closedCount').textContent = closedCount;
            document.getElementById('winningCount').textContent = winningCount;
            document.getElementById('losingCount').textContent = losingCount;
            document.getElementById('favoriteCount').textContent = favoriteCount;
            document.getElementById('totalTradesCount').textContent = allCount;
            document.getElementById('navBadgeTrades').textContent = allCount;
        }

        function updateRecentTrades() {
            const recentTrades = [...TITAN.trades]
                .sort((a, b) => new Date(b.entryDate) - new Date(a.entryDate))
                .slice(0, 5);
            
            const container = document.getElementById('recentTrades');
            if (recentTrades.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-chart-line"></i>
                        <div>Aucun trade récent</div>
                    </div>
                `;
            } else {
                container.innerHTML = recentTrades.map(trade => createTradeElement(trade)).join('');
            }
        }

        // ==========================================
        // TRADE MODAL FUNCTIONS
        // ==========================================
        function openTradeModal(trade = null) {
            TITAN.editingTrade = trade;
            TITAN.isFavorite = false;
            
            const modal = document.getElementById('tradeModal');
            const title = document.getElementById('tradeModalTitle');
            
            // Reset form
            document.getElementById('tradeForm').reset();
            
            if (trade) {
                title.textContent = 'Modifier le Trade';
                document.getElementById('tradeId').value = trade.id;
                document.getElementById('tradeSymbol').value = trade.symbol;
                document.getElementById('tradeSide').value = trade.side;
                document.getElementById('tradeEntryDate').value = trade.entryDate.slice(0, 16);
                document.getElementById('tradeExitDate').value = trade.exitDate ? trade.exitDate.slice(0, 16) : '';
                document.getElementById('tradeEntryPrice').value = trade.entryPrice;
                document.getElementById('tradeExitPrice').value = trade.exitPrice || '';
                document.getElementById('tradeStopLoss').value = trade.stopLoss || '';
                document.getElementById('tradeTakeProfit').value = trade.takeProfit || '';
                document.getElementById('tradeQuantity').value = trade.quantity;
                document.getElementById('tradeStrategy').value = trade.strategy || '';
                document.getElementById('tradeNotes').value = trade.notes || '';
                
                // Set emotion
                if (trade.emotion) {
                    document.querySelector(`input[name="emotion"][value="${trade.emotion}"]`).checked = true;
                }
                
                // Set tags
                document.querySelectorAll('#tradeTags .tag-pill').forEach(tag => {
                    tag.classList.remove('selected');
                });
                (trade.tags || []).forEach(tagText => {
                    const tag = Array.from(document.querySelectorAll('#tradeTags .tag-pill'))
                        .find(t => t.textContent === tagText);
                    if (tag) tag.classList.add('selected');
                });
                
                // Set favorite
                TITAN.isFavorite = trade.isFavorite || false;
                updateFavoriteButton();
            } else {
                title.textContent = 'Nouveau Trade';
                document.getElementById('tradeId').value = '';
                
                // Set current date/time
                const now = new Date();
                now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
                document.getElementById('tradeEntryDate').value = now.toISOString().slice(0, 16);
            }
            
            modal.classList.add('active');
            calculateLiveRR();
        }

        function closeModal() {
            document.getElementById('tradeModal').classList.remove('active');
            TITAN.editingTrade = null;
        }

        function calculateLiveRR() {
            const entryPrice = parseFloat(document.getElementById('tradeEntryPrice').value);
            const stopLoss = parseFloat(document.getElementById('tradeStopLoss').value);
            const takeProfit = parseFloat(document.getElementById('tradeTakeProfit').value);
            const quantity = parseFloat(document.getElementById('tradeQuantity').value);
            
            if (entryPrice && stopLoss) {
                const riskAmount = PositionCalculator.calculateRiskAmount(1, entryPrice, stopLoss) * (quantity || 0);
                document.getElementById('liveRisk').textContent = formatCurrency(riskAmount);
                
                if (takeProfit) {
                    const rrRatio = PositionCalculator.calculateRRRatio(entryPrice, stopLoss, takeProfit);
                    document.getElementById('liveRR').textContent = rrRatio.toFixed(2);
                    document.getElementById('liveRR').style.color = rrRatio >= 2 ? 'var(--success)' : 'var(--warning)';
                }
                
                if (entryPrice && quantity) {
                    const positionValue = entryPrice * quantity;
                    document.getElementById('livePositionValue').textContent = formatCurrency(positionValue);
                }
            }
        }

        function toggleFavorite() {
            TITAN.isFavorite = !TITAN.isFavorite;
            updateFavoriteButton();
        }

        function updateFavoriteButton() {
            const btn = document.getElementById('favoriteBtn');
            const icon = btn.querySelector('i');
            
            if (TITAN.isFavorite) {
                icon.className = 'fas fa-star';
                btn.innerHTML = '<i class="fas fa-star"></i> Favori';
            } else {
                icon.className = 'far fa-star';
                btn.innerHTML = '<i class="far fa-star"></i> Favori';
            }
        }

        function toggleTag(element) {
            element.classList.toggle('selected');
        }

        function saveTrade(event) {
            event.preventDefault();
            
            // Get form values
            const trade = {
                id: document.getElementById('tradeId').value || 'trade_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                symbol: document.getElementById('tradeSymbol').value.toUpperCase(),
                side: document.getElementById('tradeSide').value,
                entryDate: document.getElementById('tradeEntryDate').value,
                exitDate: document.getElementById('tradeExitDate').value || null,
                entryPrice: parseFloat(document.getElementById('tradeEntryPrice').value),
                exitPrice: document.getElementById('tradeExitPrice').value ? parseFloat(document.getElementById('tradeExitPrice').value) : null,
                stopLoss: document.getElementById('tradeStopLoss').value ? parseFloat(document.getElementById('tradeStopLoss').value) : null,
                takeProfit: document.getElementById('tradeTakeProfit').value ? parseFloat(document.getElementById('tradeTakeProfit').value) : null,
                quantity: parseFloat(document.getElementById('tradeQuantity').value),
                strategy: document.getElementById('tradeStrategy').value,
                notes: document.getElementById('tradeNotes').value,
                emotion: document.querySelector('input[name="emotion"]:checked').value,
                tags: Array.from(document.querySelectorAll('#tradeTags .tag-pill.selected')).map(t => t.textContent),
                isFavorite: TITAN.isFavorite
            };
            
            // Calculate PnL if trade is closed
            if (trade.exitPrice) {
                trade.pnl = PositionCalculator.calculatePnl(
                    trade.entryPrice,
                    trade.exitPrice,
                    trade.quantity,
                    trade.side,
                    TITAN.settings.fees
                );
            } else {
                trade.pnl = null;
            }
            
            // Check for overtrading
            if (!TITAN.editingTrade) {
                const today = new Date().toDateString();
                const todayTrades = TITAN.trades.filter(t => 
                    new Date(t.entryDate).toDateString() === today
                ).length;
                
                if (todayTrades >= 5) {
                    showToast('⚠️ Attention: 6ème trade aujourd\'hui. Risque d\'overtrading!', 'warning');
                }
            }
            
            // Save trade
            if (TITAN.editingTrade) {
                const index = TITAN.trades.findIndex(t => t.id === TITAN.editingTrade.id);
                if (index !== -1) {
                    TITAN.trades[index] = trade;
                }
            } else {
                TITAN.trades.unshift(trade);
            }
            
            // Save data and update UI
            saveUserData();
            updateUI();
            closeModal();
            
            showToast('Trade enregistré avec succès', 'success');
        }

        function editTrade(tradeId) {
            const trade = TITAN.trades.find(t => t.id === tradeId);
            if (trade) {
                openTradeModal(trade);
            }
        }

        function deleteTrade(tradeId, event) {
            if (event) event.stopPropagation();
            
            showConfirmation(
                'Supprimer ce trade ?',
                'Cette action est irréversible.',
                () => {
                    TITAN.trades = TITAN.trades.filter(t => t.id !== tradeId);
                    saveUserData();
                    updateUI();
                    showToast('Trade supprimé', 'success');
                }
            );
        }

        function toggleTradeFavorite(tradeId, event) {
            if (event) event.stopPropagation();
            
            const trade = TITAN.trades.find(t => t.id === tradeId);
            if (trade) {
                trade.isFavorite = !trade.isFavorite;
                saveUserData();
                updateUI();
                
                showToast(
                    trade.isFavorite ? 'Ajouté aux favoris' : 'Retiré des favoris',
                    'info'
                );
            }
        }

        // ==========================================
        // CALENDAR & HEATMAP
        // ==========================================
        function renderCalendar() {
            const monthSelect = document.getElementById('calendarMonth');
            if (!monthSelect.options.length) {
                // Populate month select
                const months = [
                    'Janvier', 'Février', 'Mars', 'Avril', 'Mai', 'Juin',
                    'Juillet', 'Août', 'Septembre', 'Octobre', 'Novembre', 'Décembre'
                ];
                const currentMonth = new Date().getMonth();
                
                months.forEach((month, index) => {
                    const option = document.createElement('option');
                    option.value = index;
                    option.textContent = month;
                    if (index === currentMonth) option.selected = true;
                    monthSelect.appendChild(option);
                });
            }
            
            const selectedMonth = parseInt(monthSelect.value);
            const currentYear = new Date().getFullYear();
            const container = document.getElementById('calendarGrid');
            
            // Clear container
            container.innerHTML = '';
            
            // Add day headers
            ['L', 'M', 'M', 'J', 'V', 'S', 'D'].forEach(day => {
                const header = document.createElement('div');
                header.className = 'cal-day-header';
                header.textContent = day;
                container.appendChild(header);
            });
            
            // Calculate first day of month
            const firstDay = new Date(currentYear, selectedMonth, 1).getDay();
            const offset = firstDay === 0 ? 6 : firstDay - 1; // Start from Monday
            
            // Add empty days for offset
            for (let i = 0; i < offset; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'cal-day empty';
                container.appendChild(emptyDay);
            }
            
            // Add days of month
            const daysInMonth = new Date(currentYear, selectedMonth + 1, 0).getDate();
            
            for (let day = 1; day <= daysInMonth; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'cal-day';
                dayElement.textContent = day;
                
                // Check if today
                const today = new Date();
                if (day === today.getDate() && selectedMonth === today.getMonth() && currentYear === today.getFullYear()) {
                    dayElement.classList.add('today');
                }
                
                // Check for trades on this day
                const tradesOnDay = TITAN.trades.filter(trade => {
                    const tradeDate = new Date(trade.entryDate);
                    return tradeDate.getDate() === day &&
                           tradeDate.getMonth() === selectedMonth &&
                           tradeDate.getFullYear() === currentYear;
                });
                
                if (tradesOnDay.length > 0) {
                    const totalPnl = tradesOnDay.reduce((sum, t) => sum + (t.pnl || 0), 0);
                    
                    if (totalPnl > 0) {
                        dayElement.classList.add('has-profit');
                        dayElement.title = `+${formatCurrency(totalPnl)}`;
                    } else if (totalPnl < 0) {
                        dayElement.classList.add('has-loss');
                        dayElement.title = formatCurrency(totalPnl);
                    } else {
                        dayElement.classList.add('has-mixed');
                        dayElement.title = `${tradesOnDay.length} trade(s) neutre(s)`;
                    }
                }
                
                container.appendChild(dayElement);
            }
        }

        function renderHeatmap() {
            const container = document.getElementById('githubHeatmap');
            if (!container) return;
            
            // Clear container
            container.innerHTML = '';
            
            // Create heatmap data for last 52 weeks
            const weeks = 52;
            const daysInWeek = 7;
            
            // Initialize data structure
            const heatmapData = Array(weeks).fill().map(() => Array(daysInWeek).fill(0));
            
            // Get date range for heatmap
            const endDate = new Date();
            const startDate = new Date();
            startDate.setDate(startDate.getDate() - weeks * 7);
            
            // Count trades per day
            TITAN.trades.forEach(trade => {
                const tradeDate = new Date(trade.entryDate);
                if (tradeDate >= startDate && tradeDate <= endDate) {
                    const weekIndex = Math.floor((endDate - tradeDate) / (7 * 24 * 60 * 60 * 1000));
                    const dayIndex = tradeDate.getDay(); // 0 = Sunday, 6 = Saturday
                    
                    if (weekIndex >= 0 && weekIndex < weeks) {
                        // Convert Sunday (0) to Saturday (6) to Monday (0) to Sunday (6)
                        const adjustedDayIndex = dayIndex === 0 ? 6 : dayIndex - 1;
                        heatmapData[weekIndex][adjustedDayIndex]++;
                    }
                }
            });
            
            // Find maximum count for normalization
            const maxCount = Math.max(...heatmapData.flat());
            
            // Render heatmap
            for (let week = 0; week < weeks; week++) {
                const column = document.createElement('div');
                column.className = 'github-heatmap-column';
                
                for (let day = 0; day < daysInWeek; day++) {
                    const count = heatmapData[week][day];
                    const cell = document.createElement('div');
                    cell.className = 'github-heatmap-cell';
                    
                    if (count > 0) {
                        const intensity = Math.min(Math.ceil(count / (maxCount / 5)), 5);
                        cell.setAttribute('data-count', intensity);
                        cell.title = `${count} trade(s)`;
                    }
                    
                    column.appendChild(cell);
                }
                
                container.appendChild(column);
            }
        }

        // ==========================================
        // CALCULATOR FUNCTIONS
        // ==========================================
        function initCalculator() {
            // Set default values
            document.getElementById('calcCapital').value = TITAN.settings.capital;
            document.getElementById('calcRiskPercent').value = TITAN.settings.riskPerTrade;
        }

        function calculatePosition() {
            const capital = parseFloat(document.getElementById('calcCapital').value) || TITAN.settings.capital;
            const riskPercent = parseFloat(document.getElementById('calcRiskPercent').value) || 2;
            const entryPrice = parseFloat(document.getElementById('calcEntryPrice').value);
            const stopLoss = parseFloat(document.getElementById('calcStopLoss').value);
            const takeProfit = parseFloat(document.getElementById('calcTakeProfit').value);
            const fees = parseFloat(document.getElementById('calcFees').value) || 0.1;
            
            if (!entryPrice || !stopLoss) {
                showToast('Entrez au moins le prix d\'entrée et le stop loss', 'warning');
                return;
            }
            
            // Calculate position size
            const positionSize = PositionCalculator.calculatePositionSize(capital, riskPercent, entryPrice, stopLoss);
            const riskAmount = PositionCalculator.calculateRiskAmount(positionSize, entryPrice, stopLoss);
            const rrRatio = takeProfit ? PositionCalculator.calculateRRRatio(entryPrice, stopLoss, takeProfit) : 0;
            const positionValue = entryPrice * positionSize;
            const profitPotential = takeProfit ? Math.abs(takeProfit - entryPrice) * positionSize : 0;
            const riskPercentOfCapital = (riskAmount / capital) * 100;
            
            // Update results display
            document.getElementById('calcEmpty').style.display = 'none';
            document.getElementById('calcResults').style.display = 'block';
            
            document.getElementById('calcPositionSize').textContent = positionSize.toFixed(4);
            document.getElementById('calcRiskAmount').textContent = formatCurrency(riskAmount);
            document.getElementById('calcRR').textContent = rrRatio.toFixed(2);
            document.getElementById('calcPositionValue').textContent = formatCurrency(positionValue);
            document.getElementById('calcProfitPotential').textContent = formatCurrency(profitPotential);
            document.getElementById('calcRiskPercentResult').textContent = riskPercentOfCapital.toFixed(1) + '%';
            
            // Generate recommendation
            let recommendation = '';
            let confidence = 95;
            
            if (riskPercentOfCapital > 5) {
                recommendation = '⚠️ Risque trop élevé (>5% du capital). Réduisez votre position.';
                confidence = 60;
            } else if (rrRatio >= 2) {
                recommendation = '✅ Excellent ratio R/R (≥ 2:1). Trade recommandé.';
                confidence = 90;
            } else if (rrRatio >= 1) {
                recommendation = '📊 Ratio R/R correct. Trade acceptable avec bonne gestion de risque.';
                confidence = 75;
            } else {
                recommendation = '📉 Ratio R/R défavorable (< 1:1). Évitez ce trade.';
                confidence = 80;
            }
            
            document.getElementById('calcRecommendationText').textContent = recommendation;
            document.getElementById('calcRecommendation').querySelector('.ai-recommendation-confidence').textContent = 
                `Confiance: ${confidence}%`;
        }

        function calculateTargetPrice() {
            const entryPrice = parseFloat(document.getElementById('calcEntryPrice').value);
            const stopLoss = parseFloat(document.getElementById('calcStopLoss').value);
            
            if (!entryPrice || !stopLoss) {
                showToast('Entrez le prix d\'entrée et le stop loss', 'warning');
                return;
            }
            
            const desiredRR = parseFloat(prompt('Ratio R/R désiré ?', '2'));
            if (isNaN(desiredRR) || desiredRR <= 0) return;
            
            const risk = Math.abs(entryPrice - stopLoss);
            const targetPrice = entryPrice > stopLoss ? 
                entryPrice + (risk * desiredRR) : 
                entryPrice - (risk * desiredRR);
            
            document.getElementById('calcTakeProfit').value = targetPrice.toFixed(4);
            calculatePosition();
        }

        function quickPositionCalc() {
            const entryPrice = parseFloat(document.getElementById('quickEntryPrice').value);
            const stopLoss = parseFloat(document.getElementById('quickStopLoss').value);
            
            if (!entryPrice || !stopLoss) {
                showToast('Remplissez les deux champs', 'warning');
                return;
            }
            
            const positionSize = PositionCalculator.calculatePositionSize(
                TITAN.settings.capital,
                TITAN.settings.riskPerTrade,
                entryPrice,
                stopLoss
            );
            
            const riskAmount = PositionCalculator.calculateRiskAmount(positionSize, entryPrice, stopLoss);
            const positionValue = entryPrice * positionSize;
            
            const resultHTML = `
                <div class="stats-grid stats-grid-3">
                    <div class="stat-box">
                        <div class="stat-value">${positionSize.toFixed(4)}</div>
                        <div class="stat-label">Quantité</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value">${formatCurrency(riskAmount)}</div>
                        <div class="stat-label">Risque</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value">${formatCurrency(positionValue)}</div>
                        <div class="stat-label">Valeur Position</div>
                    </div>
                </div>
            `;
            
            document.getElementById('quickCalcResult').innerHTML = resultHTML;
            document.getElementById('quickCalcResult').style.display = 'block';
        }

        // ==========================================
        // SETTINGS FUNCTIONS
        // ==========================================
        function applyThemeSettings() {
            document.documentElement.setAttribute('data-theme', TITAN.settings.theme);
            document.documentElement.setAttribute('data-color', TITAN.settings.accent);
            
            // Update ghost mode
            if (TITAN.settings.ghostMode) {
                document.body.classList.add('ghost-mode');
            } else {
                document.body.classList.remove('ghost-mode');
            }
            
            // Update theme icon
            const themeIcon = document.getElementById('themeIcon');
            if (themeIcon) {
                themeIcon.className = TITAN.settings.theme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
            }
            
            // Update ghost icon
            const ghostIcon = document.getElementById('ghostIcon');
            if (ghostIcon) {
                ghostIcon.className = TITAN.settings.ghostMode ? 'fas fa-eye' : 'fas fa-eye-slash';
            }
        }

        function toggleTheme() {
            TITAN.settings.theme = TITAN.settings.theme === 'light' ? 'dark' : 'light';
            applyThemeSettings();
            saveUserData();
            
            showToast(
                `Thème ${TITAN.settings.theme === 'dark' ? 'sombre' : 'clair'} activé`,
                'info'
            );
        }

        function toggleGhostMode() {
            TITAN.settings.ghostMode = !TITAN.settings.ghostMode;
            applyThemeSettings();
            saveUserData();
            
            showToast(
                `Mode ${TITAN.settings.ghostMode ? 'discret' : 'normal'} activé`,
                'info'
            );
        }

        function setAccentColor(color) {
            TITAN.settings.accent = color;
            applyThemeSettings();
            saveUserData();
            
            showToast(`Couleur d'accent ${color} appliquée`, 'success');
        }

        function toggleConcentrationMode() {
            document.body.classList.toggle('concentration-mode');
            
            // Update icon
            const icon = document.querySelector('#concentrationToggle i');
            if (document.body.classList.contains('concentration-mode')) {
                icon.className = 'fas fa-eye-slash';
                showToast('Mode concentration activé', 'info');
            } else {
                icon.className = 'fas fa-expand';
                showToast('Mode concentration désactivé', 'info');
            }
        }

        function saveSettings() {
            TITAN.settings.capital = parseFloat(document.getElementById('settingsCapital').value) || 10000;
            TITAN.settings.currency = document.getElementById('settingsCurrency').value;
            TITAN.settings.riskPerTrade = parseFloat(document.getElementById('settingsRiskPerTrade').value) || 2;
            TITAN.settings.riskFreeRate = parseFloat(document.getElementById('settingsRiskFreeRate').value) || 2;
            TITAN.settings.fees = parseFloat(document.getElementById('settingsFees').value) || 0.06;
            TITAN.settings.ghostMode = document.getElementById('settingsGhostMode').checked;
            TITAN.settings.notifications = document.getElementById('settingsNotifications').checked;
            TITAN.settings.autoBackup = document.getElementById('settingsAutoBackup').checked;
            
            saveUserData();
            updateUI();
            
            showToast('Paramètres sauvegardés', 'success');
        }

        function resetSettings() {
            showConfirmation(
                'Réinitialiser les paramètres ?',
                'Tous vos paramètres personnalisés seront perdus.',
                () => {
                    TITAN.settings = {
                        currency: 'EUR',
                        capital: 10000,
                        theme: 'light',
                        accent: 'default',
                        fees: 0.06,
                        riskPerTrade: 2,
                        riskFreeRate: 2,
                        ghostMode: false,
                        notifications: true,
                        autoBackup: true
                    };
                    
                    applyThemeSettings();
                    saveUserData();
                    updateUI();
                    
                    showToast('Paramètres réinitialisés', 'success');
                }
            );
        }

        // ==========================================
        // EXPORT/IMPORT FUNCTIONS
        // ==========================================
        function exportAllData() {
            const data = {
                trades: TITAN.trades,
                settings: TITAN.settings,
                notifications: TITAN.notifications,
                exported: new Date().toISOString(),
                version: '2.0'
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `titan_backup_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            showToast('Données exportées avec succès', 'success');
        }

        function importData() {
            document.getElementById('importModal').classList.add('active');
        }

        function closeImportModal() {
            document.getElementById('importModal').classList.remove('active');
        }

        function processImport() {
            const fileInput = document.getElementById('importFile');
            const format = document.getElementById('importFormat').value;
            const overwrite = document.getElementById('importOverwrite').checked;
            
            if (!fileInput.files.length) {
                showToast('Sélectionnez un fichier', 'warning');
                return;
            }
            
            const file = fileInput.files[0];
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    let importedData;
                    
                    if (format === 'json') {
                        importedData = JSON.parse(e.target.result);
                    } else if (format === 'csv') {
                        importedData = parseCSV(e.target.result);
                    }
                    
                    if (overwrite) {
                        TITAN.trades = importedData.trades || [];
                        TITAN.settings = { ...TITAN.settings, ...importedData.settings };
                    } else {
                        TITAN.trades = [...(importedData.trades || []), ...TITAN.trades];
                    }
                    
                    saveUserData();
                    updateUI();
                    closeImportModal();
                    
                    showToast('Données importées avec succès', 'success');
                } catch (error) {
                    showToast('Erreur lors de l\'import: ' + error.message, 'error');
                }
            };
            
            reader.readAsText(file);
        }

        function parseCSV(csvText) {
            const lines = csvText.split('\n');
            const headers = lines[0].split(',').map(h => h.trim());
            const trades = [];
            
            for (let i = 1; i < lines.length; i++) {
                if (!lines[i].trim()) continue;
                
                const values = lines[i].split(',').map(v => v.trim());
                const trade = {};
                
                headers.forEach((header, index) => {
                    if (values[index]) {
                        const key = header.toLowerCase().replace(/[^a-z0-9]/g, '');
                        trade[key] = values[index];
                    }
                });
                
                trades.push(trade);
            }
            
            return { trades };
        }

        function backupToCloud() {
            if (TITAN.isGuest) {
                showToast('Connectez-vous pour utiliser la sauvegarde cloud', 'warning');
                return;
            }
            
            saveUserData();
            showToast('Sauvegarde cloud effectuée', 'success');
        }

        function clearCache() {
            showConfirmation(
                'Vider le cache ?',
                'Les données locales seront supprimées mais les données cloud seront conservées.',
                () => {
                    localStorage.removeItem('titan_pro_data');
                    showToast('Cache vidé', 'success');
                }
            );
        }

        function confirmDeleteAllData() {
            showConfirmation(
                'Supprimer toutes les données ?',
                'Cette action est irréversible. Toutes vos données seront perdues.',
                () => {
                    TITAN.trades = [];
                    TITAN.notifications = [];
                    saveUserData();
                    updateUI();
                    showToast('Toutes les données ont été supprimées', 'success');
                }
            );
        }

        // ==========================================
        // NOTIFICATION SYSTEM
        // ==========================================
        function toggleNotificationCenter() {
            const center = document.getElementById('notificationCenter');
            center.classList.toggle('active');
            
            if (center.classList.contains('active')) {
                updateNotificationList();
            }
        }

        function updateNotificationBadge() {
            const unreadCount = TITAN.notifications.filter(n => !n.read).length;
            const badge = document.getElementById('notificationCount');
            
            if (unreadCount > 0) {
                badge.textContent = unreadCount;
                badge.style.display = 'flex';
            } else {
                badge.style.display = 'none';
            }
        }

        function updateNotificationList() {
            const container = document.getElementById('notificationList');
            const notifications = TITAN.notifications.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            if (notifications.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-bell-slash"></i>
                        <div>Aucune notification</div>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = notifications.map(notification => `
                <div class="notification-item ${notification.read ? '' : 'unread'}" onclick="markNotificationRead('${notification.id}')">
                    <div class="notification-title">${notification.title}</div>
                    <div class="notification-message">${notification.message}</div>
                    <div class="notification-time">${formatDate(notification.date)}</div>
                </div>
            `).join('');
        }

        function addNotification(title, message, type = 'info') {
            const notification = {
                id: 'notif_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                title,
                message,
                type,
                date: new Date().toISOString(),
                read: false
            };
            
            TITAN.notifications.unshift(notification);
            
            if (TITAN.settings.notifications) {
                showToast(message, type);
            }
            
            updateNotificationBadge();
            saveUserData();
        }

        function markNotificationRead(notificationId) {
            const notification = TITAN.notifications.find(n => n.id === notificationId);
            if (notification) {
                notification.read = true;
                saveUserData();
                updateNotificationList();
                updateNotificationBadge();
            }
        }

        function clearAllNotifications() {
            TITAN.notifications = [];
            saveUserData();
            updateNotificationList();
            updateNotificationBadge();
            showToast('Notifications effacées', 'success');
        }

        // ==========================================
        // UTILITY FUNCTIONS
        // ==========================================
        function formatCurrency(amount, showSign = false) {
            if (amount === null || amount === undefined) return '€0.00';
            
            const currencySymbol = TITAN.settings.currency === 'EUR' ? '€' :
                                  TITAN.settings.currency === 'USD' ? '$' :
                                  TITAN.settings.currency === 'GBP' ? '£' : '€';
            
            const formatted = new Intl.NumberFormat('fr-FR', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(Math.abs(amount));
            
            const sign = showSign ? (amount >= 0 ? '+' : '-') : '';
            return `${sign}${currencySymbol}${formatted}`;
        }

        function formatNumber(num) {
            if (num === null || num === undefined) return '0';
            
            if (num >= 1000) {
                return new Intl.NumberFormat('fr-FR', {
                    maximumFractionDigits: 0
                }).format(num);
            } else if (num >= 1) {
                return new Intl.NumberFormat('fr-FR', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 4
                }).format(num);
            } else {
                return new Intl.NumberFormat('fr-FR', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 8
                }).format(num);
            }
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diff = now - date;
            
            if (diff < 60 * 60 * 1000) { // Less than 1 hour
                const minutes = Math.floor(diff / (60 * 1000));
                return `Il y a ${minutes} min`;
            } else if (diff < 24 * 60 * 60 * 1000) { // Less than 1 day
                const hours = Math.floor(diff / (60 * 60 * 1000));
                return `Il y a ${hours} h`;
            } else if (diff < 7 * 24 * 60 * 60 * 1000) { // Less than 1 week
                const days = Math.floor(diff / (24 * 60 * 60 * 1000));
                return `Il y a ${days} j`;
            } else {
                return date.toLocaleDateString('fr-FR');
            }
        }

        function showToast(message, type = 'info', duration = 4000) {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            const icons = {
                success: '✅',
                error: '❌',
                warning: '⚠️',
                info: '💡'
            };
            
            toast.innerHTML = `
                <div class="toast-icon">${icons[type] || icons.info}</div>
                <div>${message}</div>
                <button class="toast-close" onclick="this.parentElement.remove()">×</button>
            `;
            
            container.appendChild(toast);
            
            // Play sound if notifications enabled
            if (TITAN.settings.notifications) {
                playNotificationSound(type);
            }
            
            // Auto remove after duration
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.remove();
                }
            }, duration);
        }

        function playNotificationSound(type) {
            // Simple sound implementation using Web Audio API
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                // Different frequencies for different notification types
                switch(type) {
                    case 'success':
                        oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                        break;
                    case 'error':
                        oscillator.frequency.setValueAtTime(400, audioContext.currentTime);
                        break;
                    case 'warning':
                        oscillator.frequency.setValueAtTime(600, audioContext.currentTime);
                        break;
                    default:
                        oscillator.frequency.setValueAtTime(500, audioContext.currentTime);
                }
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.5);
            } catch (e) {
                // Audio context not supported, silently fail
            }
        }

        function showConfirmation(title, message, confirmCallback) {
            document.getElementById('confirmationTitle').textContent = title;
            document.getElementById('confirmationMessage').textContent = message;
            
            const confirmBtn = document.getElementById('confirmationConfirm');
            confirmBtn.onclick = () => {
                confirmCallback();
                closeConfirmation();
            };
            
            document.getElementById('confirmationModal').classList.add('active');
        }

        function closeConfirmation() {
            document.getElementById('confirmationModal').classList.remove('active');
        }

        // ==========================================
        // CHART FUNCTIONS
        // ==========================================
        function updateCharts() {
            updateEquityChart();
            updatePnlDistributionChart();
            updatePerformanceCharts();
        }

        function updateEquityChart() {
            const ctx = document.getElementById('equityChart');
            if (!ctx) return;
            
            // Destroy existing chart
            if (TITAN.chartInstances.equityChart) {
                TITAN.chartInstances.equityChart.destroy();
            }
            
            const equityData = PerformanceAnalytics.calculateEquityCurve(TITAN.trades, TITAN.settings.capital);
            
            // Create gradient
            const gradient = ctx.getContext('2d').createLinearGradient(0, 0, 0, 400);
            gradient.addColorStop(0, 'rgba(0, 171, 85, 0.3)');
            gradient.addColorStop(1, 'rgba(0, 171, 85, 0)');
            
            TITAN.chartInstances.equityChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: equityData.dates.map(d => d.toLocaleDateString('fr-FR')),
                    datasets: [{
                        label: 'Courbe de Capital',
                        data: equityData.curve,
                        borderColor: getComputedStyle(document.documentElement).getPropertyValue('--accent-main').trim(),
                        backgroundColor: gradient,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 0,
                        borderWidth: 3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: (context) => `Capital: ${formatCurrency(context.raw)}`
                            }
                        }
                    },
                    scales: {
                        x: { display: false },
                        y: {
                            display: false,
                            beginAtZero: false
                        }
                    }
                }
            });
        }

        function updatePnlDistributionChart() {
            const ctx = document.getElementById('pnlDistributionChart');
            if (!ctx) return;
            
            if (TITAN.chartInstances.pnlDistributionChart) {
                TITAN.chartInstances.pnlDistributionChart.destroy();
            }
            
            const closedTrades = TITAN.trades.filter(t => t.exitPrice);
            if (closedTrades.length === 0) return;
            
            const pnls = closedTrades.map(t => t.pnl || 0);
            const positivePnls = pnls.filter(p => p > 0);
            const negativePnls = pnls.filter(p => p < 0);
            const neutralPnls = pnls.filter(p => p === 0);
            
            TITAN.chartInstances.pnlDistributionChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Gagnants', 'Perdants', 'Neutres'],
                    datasets: [{
                        data: [positivePnls.length, negativePnls.length, neutralPnls.length],
                        backgroundColor: [
                            getComputedStyle(document.documentElement).getPropertyValue('--success').trim(),
                            getComputedStyle(document.documentElement).getPropertyValue('--danger').trim(),
                            getComputedStyle(document.documentElement).getPropertyValue('--text-muted').trim()
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true
                            }
                        }
                    }
                }
            });
        }

        function updatePerformanceCharts() {
            // Update other charts as needed
            // This is a placeholder for additional chart updates
        }

        // ==========================================
        // FAB & QUICK ACTIONS
        // ==========================================
        function toggleFabMenu() {
            const menu = document.getElementById('fabMenu');
            const icon = document.getElementById('fabIcon');
            
            menu.classList.toggle('open');
            icon.className = menu.classList.contains('open') ? 'fas fa-times' : 'fas fa-plus';
        }

        function quickAddTrade() {
            openTradeModal();
            toggleFabMenu();
        }

        function quickCalculator() {
            showPage('page-calculator');
            toggleFabMenu();
        }

        function exportQuickStats() {
            const analysis = PerformanceAnalytics.analyzeTrades(TITAN.trades);
            const stats = {
                summary: {
                    totalTrades: analysis.total,
                    winRate: analysis.winRate,
                    totalPnl: analysis.totalPnl,
                    profitFactor: analysis.profitFactor
                },
                date: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(stats, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `titan_stats_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            
            showToast('Statistiques exportées', 'success');
            toggleFabMenu();
        }

        // ==========================================
        // ANALYTICS FUNCTIONS
        // ==========================================
        function showAnalyticsTab(tab) {
            // Hide all tabs
            document.querySelectorAll('.analytics-tab').forEach(t => {
                t.style.display = 'none';
            });
            
            // Deactivate all tab buttons
            document.querySelectorAll('#page-analytics .tab').forEach(t => {
                t.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(`analytics-${tab}`).style.display = 'block';
            
            // Activate tab button
            event.currentTarget.classList.add('active');
            
            // Update tab content
            updateAnalyticsTab(tab);
        }

        function updateAnalyticsTab(tab) {
            switch(tab) {
                case 'performance':
                    updatePerformanceAnalytics();
                    break;
                case 'risk':
                    updateRiskAnalytics();
                    break;
                case 'behavioral':
                    updateBehavioralAnalytics();
                    break;
                case 'temporal':
                    updateTemporalAnalytics();
                    break;
            }
        }

        function updatePerformanceAnalytics() {
            // Update performance analytics content
        }

        function updateRiskAnalytics() {
            // Update risk analytics content
        }

        function updateBehavioralAnalytics() {
            // Update behavioral analytics content
        }

        function updateTemporalAnalytics() {
            // Update temporal analytics content
        }

        // ==========================================
        // PORTFOLIO FUNCTIONS
        // ==========================================
        function updatePortfolio() {
            // Calculate portfolio value
            const closedTrades = TITAN.trades.filter(t => t.exitPrice);
            const totalPnl = closedTrades.reduce((sum, t) => sum + (t.pnl || 0), 0);
            const portfolioValue = TITAN.settings.capital + totalPnl;
            
            document.getElementById('portfolioValue').textContent = formatCurrency(portfolioValue);
            
            // Calculate daily change
            const today = new Date().toDateString();
            const dailyPnl = TITAN.trades
                .filter(t => new Date(t.entryDate).toDateString() === today)
                .reduce((sum, t) => sum + (t.pnl || 0), 0);
            const dailyChange = (dailyPnl / portfolioValue) * 100;
            
            document.getElementById('portfolioDailyChange').textContent = 
                (dailyChange >= 0 ? '+' : '') + dailyChange.toFixed(2) + '%';
            document.getElementById('portfolioDailyChange').style.color = 
                dailyChange >= 0 ? 'var(--success)' : 'var(--danger)';
            
            // Count allocations
            const symbols = [...new Set(TITAN.trades.map(t => t.symbol))];
            document.getElementById('portfolioAllocations').textContent = symbols.length;
            
            // Update open positions
            updateOpenPositions();
        }

        function updateOpenPositions() {
            const openTrades = TITAN.trades.filter(t => !t.exitPrice);
            const container = document.getElementById('openPositionsList');
            
            if (openTrades.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-box-open"></i>
                        <div>Aucune position ouverte</div>
                    </div>
                `;
            } else {
                container.innerHTML = openTrades.map(trade => createTradeElement(trade)).join('');
            }
        }

        // ==========================================
        // TOOLS FUNCTIONS
        // ==========================================
        function calculateProfit() {
            const entryPrice = parseFloat(document.getElementById('profitEntry').value);
            const exitPrice = parseFloat(document.getElementById('profitExit').value);
            const quantity = parseFloat(document.getElementById('profitQuantity').value);
            const side = document.getElementById('profitSide').value;
            
            if (!entryPrice || !exitPrice || !quantity) {
                showToast('Remplissez tous les champs', 'warning');
                return;
            }
            
            const pnl = PositionCalculator.calculatePnl(entryPrice, exitPrice, quantity, side, TITAN.settings.fees);
            const percentage = (pnl / (entryPrice * quantity)) * 100;
            
            const resultHTML = `
                <div class="card">
                    <div class="card-title">Résultat du Calcul</div>
                    <div class="stats-grid stats-grid-3">
                        <div class="stat-box ${pnl >= 0 ? 'highlight' : ''}">
                            <div class="stat-value">${formatCurrency(pnl, true)}</div>
                            <div class="stat-label">Profit/Perte</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value ${percentage >= 0 ? 'trend-up' : 'trend-down'}">
                                ${percentage.toFixed(2)}%
                            </div>
                            <div class="stat-label">Pourcentage</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value">${formatCurrency(entryPrice * quantity)}</div>
                            <div class="stat-label">Valeur Position</div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('profitResult').innerHTML = resultHTML;
            document.getElementById('profitResult').style.display = 'block';
        }

        function simulateRR() {
            const winRate = parseFloat(document.getElementById('rrWinRate').value) / 100;
            const rrRatio = parseFloat(document.getElementById('rrRatio').value);
            const numTrades = parseInt(document.getElementById('rrNumTrades').value);
            
            if (isNaN(winRate) || isNaN(rrRatio) || isNaN(numTrades)) {
                showToast('Remplissez tous les champs', 'warning');
                return;
            }
            
            // Simulate trades
            let totalProfit = 0;
            let wins = 0;
            let losses = 0;
            
            for (let i = 0; i < numTrades; i++) {
                const isWin = Math.random() < winRate;
                if (isWin) {
                    totalProfit += rrRatio; // Win R units
                    wins++;
                } else {
                    totalProfit -= 1; // Lose 1 unit (R)
                    losses++;
                }
            }
            
            const winPercentage = (wins / numTrades) * 100;
            const expectedValue = (winRate * rrRatio) - ((1 - winRate) * 1);
            const minimumWinRate = (1 / (1 + rrRatio)) * 100;
            
            const resultHTML = `
                <div class="card">
                    <div class="card-title">Résultat de la Simulation</div>
                    <div class="stats-grid stats-grid-3">
                        <div class="stat-box">
                            <div class="stat-value">${wins}/${losses}</div>
                            <div class="stat-label">G/P</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value">${winPercentage.toFixed(1)}%</div>
                            <div class="stat-label">Win Rate Réel</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value">${totalProfit.toFixed(1)}R</div>
                            <div class="stat-label">Profit Total</div>
                        </div>
                    </div>
                    <div class="mt-4">
                        <div class="educational-tip">
                            <div class="tip-title"><i class="fas fa-lightbulb"></i> Analyse</div>
                            <div class="tip-content">
                                <p><strong>Expectancy:</strong> ${expectedValue.toFixed(2)}R par trade</p>
                                <p><strong>Win Rate Minimum Requis:</strong> ${minimumWinRate.toFixed(1)}%</p>
                                <p><strong>Statut:</strong> ${expectedValue > 0 ? '✅ Système rentable' : '❌ Système non rentable'}</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('rrResult').innerHTML = resultHTML;
            document.getElementById('rrResult').style.display = 'block';
        }

        // ==========================================
        // AUTO-UPDATE SYSTEM
        // ==========================================
        function startAutoUpdates() {
            // Update UI every minute
            setInterval(() => {
                if (document.visibilityState === 'visible') {
                    updateUI();
                }
            }, 60000);
            
            // Auto-backup every 5 minutes if enabled
            if (TITAN.settings.autoBackup) {
                setInterval(() => {
                    saveUserData();
                }, 300000);
            }
            
            // Check for notifications
            setInterval(() => {
                checkForNotifications();
            }, 30000);
        }

        function checkForNotifications() {
            // Check for overtrading
            const today = new Date().toDateString();
            const todayTrades = TITAN.trades.filter(t => 
                new Date(t.entryDate).toDateString() === today
            ).length;
            
            if (todayTrades >= 10 && !TITAN.notifications.some(n => n.title === 'Overtrading Alert')) {
                addNotification(
                    '⚠️ Alerte Overtrading',
                    `Vous avez effectué ${todayTrades} trades aujourd'hui. Pensez à prendre une pause.`,
                    'warning'
                );
            }
            
            // Check for large losses
            const recentTrades = TITAN.trades
                .filter(t => t.exitPrice)
                .sort((a, b) => new Date(b.exitDate || b.entryDate) - new Date(a.exitDate || a.entryDate))
                .slice(0, 5);
            
            const largeLoss = recentTrades.find(t => t.pnl < -TITAN.settings.capital * 0.05);
            if (largeLoss && !TITAN.notifications.some(n => n.title === 'Large Loss Alert')) {
                addNotification(
                    '📉 Perte Importante',
                    `Un récent trade a perdu ${formatCurrency(Math.abs(largeLoss.pnl))}. Revoyez votre gestion de risque.`,
                    'error'
                );
            }
        }

        // ==========================================
        // INITIALIZATION
        // ==========================================
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize Firebase auth
            initAuth();
            
            // Setup event listeners for auth tabs
            document.querySelectorAll('.auth-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabType = this.dataset.tab;
                    
                    document.querySelectorAll('.auth-tab').forEach(t => {
                        t.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    document.getElementById('authConfirmGroup').style.display = 
                        tabType === 'signup' ? 'block' : 'none';
                    document.getElementById('authSubmit').textContent = 
                        tabType === 'signup' ? 'Créer un compte' : 'Se connecter';
                });
            });
            
            // Setup auth form submission
            document.getElementById('authForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const isSignup = document.querySelector('.auth-tab[data-tab="signup"]').classList.contains('active');
                authAction(isSignup ? 'register' : 'login');
            });
            
            // Setup guest login
            document.getElementById('anonymousLogin').addEventListener('click', enterGuestMode);
            
            // Setup Google login
            document.getElementById('googleLogin').addEventListener('click', function() {
                showToast('Connexion Google non implémentée dans cette version', 'info');
            });
            
            // Initialize date/time for new trades
            const now = new Date();
            now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
            document.getElementById('tradeEntryDate').value = now.toISOString().slice(0, 16);
            
            // Setup search functionality
            document.getElementById('searchTrades')?.addEventListener('input', function() {
                updateTradeList(TITAN.currentTradeTab);
            });
            
            // Initialize calendar month select
            renderCalendar();
            
            // Check for first time user
            const firstTime = !localStorage.getItem('titan_first_visit');
            if (firstTime) {
                localStorage.setItem('titan_first_visit', 'true');
                setTimeout(() => {
                    showToast('👋 Bienvenue sur TITAN Pro ! Explorez toutes les fonctionnalités avancées.', 'info', 8000);
                }, 2000);
            }
            
            // Add sample data for demo
            if (TITAN.trades.length === 0 && TITAN.isGuest) {
                addSampleData();
            }
        });

        function addSampleData() {
            const sampleTrades = [
                {
                    id: 'sample_1',
                    symbol: 'BTC/USD',
                    side: 'long',
                    entryDate: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString(),
                    exitDate: new Date(Date.now() - 6 * 24 * 60 * 60 * 1000).toISOString(),
                    entryPrice: 45000,
                    exitPrice: 46500,
                    quantity: 0.1,
                    pnl: 150,
                    strategy: 'Breakout',
                    emotion: 'happy',
                    tags: ['#Trend', '#Breakout']
                },
                {
                    id: 'sample_2',
                    symbol: 'ETH/USD',
                    side: 'short',
                    entryDate: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000).toISOString(),
                    exitDate: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString(),
                    entryPrice: 3200,
                    exitPrice: 3100,
                    quantity: 1,
                    pnl: 100,
                    strategy: 'Pullback',
                    emotion: 'neutral',
                    tags: ['#Reversal']
                }
            ];
            
            TITAN.trades = [...sampleTrades, ...TITAN.trades];
            saveUserData();
            updateUI();
        }

        // ==========================================
        // EXPORT FUNCTIONS TO WINDOW OBJECT
        // ==========================================
        window.showPage = showPage;
        window.toggleGhostMode = toggleGhostMode;
        window.toggleConcentrationMode = toggleConcentrationMode;
        window.toggleTheme = toggleTheme;
        window.setAccentColor = setAccentColor;
        window.setTheme = function(theme) {
            TITAN.settings.theme = theme;
            applyThemeSettings();
            saveUserData();
        };
        window.openTradeModal = openTradeModal;
        window.closeModal = closeModal;
        window.editTrade = editTrade;
        window.filterTrades = updateTradeList;
        window.deleteTrade = deleteTrade;
        window.toggleTradeFavorite = toggleTradeFavorite;
        window.calculateLiveRR = calculateLiveRR;
        window.toggleFavorite = toggleFavorite;
        window.toggleTag = toggleTag;
        window.saveTrade = saveTrade;
        window.calculatePosition = calculatePosition;
        window.calculateTargetPrice = calculateTargetPrice;
        window.quickPositionCalc = quickPositionCalc;
        window.calculateProfit = calculateProfit;
        window.simulateRR = simulateRR;
        window.saveSettings = saveSettings;
        window.resetSettings = resetSettings;
        window.exportAllData = exportAllData;
        window.importData = importData;
        window.backupToCloud = backupToCloud;
        window.clearCache = clearCache;
        window.confirmDeleteAllData = confirmDeleteAllData;
        window.logout = logout;
        window.toggleFabMenu = toggleFabMenu;
        window.quickAddTrade = quickAddTrade;
        window.quickCalculator = quickCalculator;
        window.exportQuickStats = exportQuickStats;
        window.showAnalyticsTab = showAnalyticsTab;
        window.showConfirmation = showConfirmation;
        window.closeConfirmation = closeConfirmation;
        window.processImport = processImport;
        window.closeImportModal = closeImportModal;
        window.toggleNotificationCenter = toggleNotificationCenter;
        window.markNotificationRead = markNotificationRead;
        window.clearAllNotifications = clearAllNotifications;
        window.applyTradeTemplate = function(template) {
            showToast(`Template ${template} appliqué`, 'info');
        };
        window.fillFromCalculator = function() {
            showToast('Remplissage depuis calculateur', 'info');
        };
        window.exportTradesCSV = function() {
            showToast('Export CSV non implémenté dans cette version', 'info');
        };
        window.importTradesCSV = function() {
            showToast('Import CSV non implémenté dans cette version', 'info');
        };
        window.openMarketScanner = function() {
            showToast('Market Scanner non implémenté dans cette version', 'info');
        };
        window.openCorrelationMatrix = function() {
            showToast('Matrice de corrélation non implémentée', 'info');
        };
        window.openVolatilityAnalyzer = function() {
            showToast('Analyseur de volatilité non implémenté', 'info');
        };
        window.showDailySummary = function() {
            const today = new Date().toDateString();
            const todayTrades = TITAN.trades.filter(t => 
                new Date(t.entryDate).toDateString() === today
            );
            const dailyPnl = todayTrades.reduce((sum, t) => sum + (t.pnl || 0), 0);
            
            showToast(
                `Aujourd'hui: ${todayTrades.length} trades, ${formatCurrency(dailyPnl, true)}`,
                dailyPnl >= 0 ? 'success' : 'error'
            );
        };
        window.updateEquityChart = updateEquityChart;
        window.renderCalendar = renderCalendar;
        window.authAction = authAction;
        window.enterGuestMode = enterGuestMode;
    </script>
</body>
</html>
